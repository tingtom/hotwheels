"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[510],{60814:function(e,t,n){n.d(t,{L9:function(){return eY},_F:function(){return eB},iV:function(){return t2},q$:function(){return tC}});var r,i,a,l,s,o,c=n(85893),h=n(67294),f=n(70211),p=n(51410),d=n(18170),u=n(5631),g=n(13068),y=n(13251),m=n(89095),k=n(96381),v=n(57122),_=n(77493),b=n(23279),x=n.n(b),w=n(18446),M=n.n(w),E=n(23493),T=n.n(E),N=n(92586),D=n(42076),A=n(85564),P=n.n(A),I=n(13218),L=n.n(I),C=n(44908),S=n.n(C),O=n(62997),R=n.n(O),B=n(14176),j=n.n(B),Y=n(52353),W=n.n(Y),J=n(27361),V=n.n(J),z=n(97738),F=n(47037),U=n.n(F),$=n(30998),H=n.n($),q=n(57557),Z=n.n(q),G=n(66678),X=n.n(G),K=n(18156),Q=n(76590),ee=n(14141);let et=["_type","_key"],en=["_type","_key"],er=["value","_key","_type","__inline","children"],ei=["children"],ea=["children"],el=["listItem","level"],es=["hotkeys","onBeforeInput","onPaste","onCopy","renderAnnotation","renderBlock","renderChild","renderDecorator","renderListItem","renderPlaceholder","renderStyle","selection","scrollSelectionIntoView","spellCheck"];function eo(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function ec(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function eh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ef(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eh(Object(n),!0).forEach(function(t){var r,i;r=e,i=n[t],t in r?Object.defineProperty(r,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[t]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eh(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ep={exports:{}};function ed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{type:"setIfMissing",path:t,value:e}}r=ep,(i=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}).Diff=function(e,t){return[e,t]},i.prototype.diff_main=function(e,t,n,r){void 0===r&&(r=this.Diff_Timeout<=0?Number.MAX_VALUE:new Date().getTime()+1e3*this.Diff_Timeout);var a=r;if(null==e||null==t)throw Error("Null input. (diff_main)");if(e==t)return e?[new i.Diff(0,e)]:[];void 0===n&&(n=!0);var l=n,s=this.diff_commonPrefix(e,t),o=e.substring(0,s);e=e.substring(s),t=t.substring(s),s=this.diff_commonSuffix(e,t);var c=e.substring(e.length-s);e=e.substring(0,e.length-s),t=t.substring(0,t.length-s);var h=this.diff_compute_(e,t,l,a);return o&&h.unshift(new i.Diff(0,o)),c&&h.push(new i.Diff(0,c)),this.diff_cleanupMerge(h),h},i.prototype.diff_compute_=function(e,t,n,r){if(!e)return[new i.Diff(1,t)];if(!t)return[new i.Diff(-1,e)];var a,l=e.length>t.length?e:t,s=e.length>t.length?t:e,o=l.indexOf(s);if(-1!=o)return a=[new i.Diff(1,l.substring(0,o)),new i.Diff(0,s),new i.Diff(1,l.substring(o+s.length))],e.length>t.length&&(a[0][0]=a[2][0]=-1),a;if(1==s.length)return[new i.Diff(-1,e),new i.Diff(1,t)];var c=this.diff_halfMatch_(e,t);if(c){var h=c[0],f=c[1],p=c[2],d=c[3],u=c[4],g=this.diff_main(h,p,n,r),y=this.diff_main(f,d,n,r);return g.concat([new i.Diff(0,u)],y)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,r):this.diff_bisect_(e,t,r)},i.prototype.diff_lineMode_=function(e,t,n){var r=this.diff_linesToChars_(e,t);e=r.chars1,t=r.chars2;var a=r.lineArray,l=this.diff_main(e,t,!1,n);this.diff_charsToLines_(l,a),this.diff_cleanupSemantic(l),l.push(new i.Diff(0,""));for(var s=0,o=0,c=0,h="",f="";s<l.length;){switch(l[s][0]){case 1:c++,f+=l[s][1];break;case -1:o++,h+=l[s][1];break;case 0:if(o>=1&&c>=1){l.splice(s-o-c,o+c),s=s-o-c;for(var p=this.diff_main(h,f,!1,n),d=p.length-1;d>=0;d--)l.splice(s,0,p[d]);s+=p.length}c=0,o=0,h="",f=""}s++}return l.pop(),l},i.prototype.diff_bisect_=function(e,t,n){for(var r=e.length,a=t.length,l=Math.ceil((r+a)/2),s=2*l,o=Array(s),c=Array(s),h=0;h<s;h++)o[h]=-1,c[h]=-1;o[l+1]=0,c[l+1]=0;for(var f=r-a,p=f%2!=0,d=0,u=0,g=0,y=0,m=0;m<l&&!(new Date().getTime()>n);m++){for(var k=-m+d;k<=m-u;k+=2){for(var v,_=l+k,b=(v=k==-m||k!=m&&o[_-1]<o[_+1]?o[_+1]:o[_-1]+1)-k;v<r&&b<a&&e.charAt(v)==t.charAt(b);)v++,b++;if(o[_]=v,v>r)u+=2;else if(b>a)d+=2;else if(p){var x=l+f-k;if(x>=0&&x<s&&-1!=c[x]){var w=r-c[x];if(v>=w)return this.diff_bisectSplit_(e,t,v,b,n)}}}for(var M=-m+g;M<=m-y;M+=2){for(var w,x=l+M,E=(w=M==-m||M!=m&&c[x-1]<c[x+1]?c[x+1]:c[x-1]+1)-M;w<r&&E<a&&e.charAt(r-w-1)==t.charAt(a-E-1);)w++,E++;if(c[x]=w,w>r)y+=2;else if(E>a)g+=2;else if(!p){var _=l+f-M;if(_>=0&&_<s&&-1!=o[_]){var v=o[_],b=l+v-_;if(v>=(w=r-w))return this.diff_bisectSplit_(e,t,v,b,n)}}}}return[new i.Diff(-1,e),new i.Diff(1,t)]},i.prototype.diff_bisectSplit_=function(e,t,n,r,i){var a=e.substring(0,n),l=t.substring(0,r),s=e.substring(n),o=t.substring(r),c=this.diff_main(a,l,!1,i),h=this.diff_main(s,o,!1,i);return c.concat(h)},i.prototype.diff_linesToChars_=function(e,t){var n=[],r={};function i(e){for(var t="",i=0,l=-1,s=n.length;l<e.length-1;){-1==(l=e.indexOf("\n",i))&&(l=e.length-1);var o=e.substring(i,l+1);(r.hasOwnProperty?r.hasOwnProperty(o):void 0!==r[o])?t+=String.fromCharCode(r[o]):(s==a&&(o=e.substring(i),l=e.length),t+=String.fromCharCode(s),r[o]=s,n[s++]=o),i=l+1}return t}n[0]="";var a=4e4;return a=65535,{chars1:i(e),chars2:i(t),lineArray:n}},i.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var r=e[n][1],i=[],a=0;a<r.length;a++)i[a]=t[r.charCodeAt(a)];e[n][1]=i.join("")}},i.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,a=0;n<i;)e.substring(a,i)==t.substring(a,i)?a=n=i:r=i,i=Math.floor((r-n)/2+n);return i},i.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,a=0;n<i;)e.substring(e.length-i,e.length-a)==t.substring(t.length-i,t.length-a)?a=n=i:r=i,i=Math.floor((r-n)/2+n);return i},i.prototype.diff_commonOverlap_=function(e,t){var n=e.length,r=t.length;if(0==n||0==r)return 0;n>r?e=e.substring(n-r):n<r&&(t=t.substring(0,n));var i=Math.min(n,r);if(e==t)return i;for(var a=0,l=1;;){var s=e.substring(i-l),o=t.indexOf(s);if(-1==o)return a;l+=o,(0==o||e.substring(i-l)==t.substring(0,l))&&(a=l,l++)}},i.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n,r,i,a,l,s=e.length>t.length?e:t,o=e.length>t.length?t:e;if(s.length<4||2*o.length<s.length)return null;var c=this;function h(e,t,n){for(var r,i,a,l,s=e.substring(n,n+Math.floor(e.length/4)),o=-1,h="";-1!=(o=t.indexOf(s,o+1));){var f=c.diff_commonPrefix(e.substring(n),t.substring(o)),p=c.diff_commonSuffix(e.substring(0,n),t.substring(0,o));h.length<p+f&&(h=t.substring(o-p,o)+t.substring(o,o+f),r=e.substring(0,n-p),i=e.substring(n+f),a=t.substring(0,o-p),l=t.substring(o+f))}return 2*h.length>=e.length?[r,i,a,l,h]:null}var f=h(s,o,Math.ceil(s.length/4)),p=h(s,o,Math.ceil(s.length/2));return f||p?(n=p?f&&f[4].length>p[4].length?f:p:f,e.length>t.length?(r=n[0],i=n[1],a=n[2],l=n[3]):(a=n[0],l=n[1],r=n[2],i=n[3]),[r,i,a,l,n[4]]):null},i.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],r=0,a=null,l=0,s=0,o=0,c=0,h=0;l<e.length;)0==e[l][0]?(n[r++]=l,s=c,o=h,c=0,h=0,a=e[l][1]):(1==e[l][0]?c+=e[l][1].length:h+=e[l][1].length,a&&a.length<=Math.max(s,o)&&a.length<=Math.max(c,h)&&(e.splice(n[r-1],0,new i.Diff(-1,a)),e[n[r-1]+1][0]=1,r--,l=--r>0?n[r-1]:-1,s=0,o=0,c=0,h=0,a=null,t=!0)),l++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),l=1;l<e.length;){if(-1==e[l-1][0]&&1==e[l][0]){var f=e[l-1][1],p=e[l][1],d=this.diff_commonOverlap_(f,p),u=this.diff_commonOverlap_(p,f);d>=u?(d>=f.length/2||d>=p.length/2)&&(e.splice(l,0,new i.Diff(0,p.substring(0,d))),e[l-1][1]=f.substring(0,f.length-d),e[l+1][1]=p.substring(d),l++):(u>=f.length/2||u>=p.length/2)&&(e.splice(l,0,new i.Diff(0,f.substring(0,u))),e[l-1][0]=1,e[l-1][1]=p.substring(0,p.length-u),e[l+1][0]=-1,e[l+1][1]=f.substring(u),l++),l++}l++}},i.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),r=t.charAt(0),a=n.match(i.nonAlphaNumericRegex_),l=r.match(i.nonAlphaNumericRegex_),s=a&&n.match(i.whitespaceRegex_),o=l&&r.match(i.whitespaceRegex_),c=s&&n.match(i.linebreakRegex_),h=o&&r.match(i.linebreakRegex_),f=c&&e.match(i.blanklineEndRegex_),p=h&&t.match(i.blanklineStartRegex_);return f||p?5:c||h?4:a&&!s&&o?3:s||o?2:a||l?1:0}for(var n=1;n<e.length-1;){if(0==e[n-1][0]&&0==e[n+1][0]){var r=e[n-1][1],a=e[n][1],l=e[n+1][1],s=this.diff_commonSuffix(r,a);if(s){var o=a.substring(a.length-s);r=r.substring(0,r.length-s),a=o+a.substring(0,a.length-s),l=o+l}for(var c=r,h=a,f=l,p=t(r,a)+t(a,l);a.charAt(0)===l.charAt(0);){r+=a.charAt(0),a=a.substring(1)+l.charAt(0),l=l.substring(1);var d=t(r,a)+t(a,l);d>=p&&(p=d,c=r,h=a,f=l)}e[n-1][1]!=c&&(c?e[n-1][1]=c:(e.splice(n-1,1),n--),e[n][1]=h,f?e[n+1][1]=f:(e.splice(n+1,1),n--))}n++}},i.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,i.whitespaceRegex_=/\s/,i.linebreakRegex_=/[\r\n]/,i.blanklineEndRegex_=/\n\r?\n$/,i.blanklineStartRegex_=/^\r?\n\r?\n/,i.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],r=0,a=null,l=0,s=!1,o=!1,c=!1,h=!1;l<e.length;)0==e[l][0]?(e[l][1].length<this.Diff_EditCost&&(c||h)?(n[r++]=l,s=c,o=h,a=e[l][1]):(r=0,a=null),c=h=!1):(-1==e[l][0]?h=!0:c=!0,a&&(s&&o&&c&&h||a.length<this.Diff_EditCost/2&&s+o+c+h==3)&&(e.splice(n[r-1],0,new i.Diff(-1,a)),e[n[r-1]+1][0]=1,r--,a=null,s&&o?(c=h=!0,r=0):(l=--r>0?n[r-1]:-1,c=h=!1),t=!0)),l++;t&&this.diff_cleanupMerge(e)},i.prototype.diff_cleanupMerge=function(e){e.push(new i.Diff(0,""));for(var t,n=0,r=0,a=0,l="",s="";n<e.length;)switch(e[n][0]){case 1:a++,s+=e[n][1],n++;break;case -1:r++,l+=e[n][1],n++;break;case 0:r+a>1?(0!==r&&0!==a&&(0!==(t=this.diff_commonPrefix(s,l))&&(n-r-a>0&&0==e[n-r-a-1][0]?e[n-r-a-1][1]+=s.substring(0,t):(e.splice(0,0,new i.Diff(0,s.substring(0,t))),n++),s=s.substring(t),l=l.substring(t)),0!==(t=this.diff_commonSuffix(s,l))&&(e[n][1]=s.substring(s.length-t)+e[n][1],s=s.substring(0,s.length-t),l=l.substring(0,l.length-t))),n-=r+a,e.splice(n,r+a),l.length&&(e.splice(n,0,new i.Diff(-1,l)),n++),s.length&&(e.splice(n,0,new i.Diff(1,s)),n++),n++):0!==n&&0==e[n-1][0]?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,a=0,r=0,l="",s=""}""===e[e.length-1][1]&&e.pop();var o=!1;for(n=1;n<e.length-1;)0==e[n-1][0]&&0==e[n+1][0]&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),o=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),o=!0)),n++;o&&this.diff_cleanupMerge(e)},i.prototype.diff_xIndex=function(e,t){var n,r=0,i=0,a=0,l=0;for(n=0;n<e.length&&(1!==e[n][0]&&(r+=e[n][1].length),-1!==e[n][0]&&(i+=e[n][1].length),!(r>t));n++)a=r,l=i;return e.length!=n&&-1===e[n][0]?l:l+(t-a)},i.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,r=/</g,i=/>/g,a=/\n/g,l=0;l<e.length;l++){var s=e[l][0],o=e[l][1].replace(n,"&amp;").replace(r,"&lt;").replace(i,"&gt;").replace(a,"&para;<br>");switch(s){case 1:t[l]='<ins style="background:#e6ffe6;">'+o+"</ins>";break;case -1:t[l]='<del style="background:#ffe6e6;">'+o+"</del>";break;case 0:t[l]="<span>"+o+"</span>"}}return t.join("")},i.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)-1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_levenshtein=function(e){for(var t=0,n=0,r=0,i=0;i<e.length;i++){var a=e[i][0],l=e[i][1];switch(a){case 1:n+=l.length;break;case -1:r+=l.length;break;case 0:t+=Math.max(n,r),n=0,r=0}}return t+Math.max(n,r)},i.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case 1:t[n]="+"+encodeURI(e[n][1]);break;case -1:t[n]="-"+e[n][1].length;break;case 0:t[n]="="+e[n][1].length}return t.join("	").replace(/%20/g," ")},i.prototype.diff_fromDelta=function(e,t){for(var n=[],r=0,a=0,l=t.split(/\t/g),s=0;s<l.length;s++){var o=l[s].substring(1);switch(l[s].charAt(0)){case"+":try{n[r++]=new i.Diff(1,decodeURI(o))}catch(c){throw Error("Illegal escape in diff_fromDelta: "+o)}break;case"-":case"=":var h=parseInt(o,10);if(isNaN(h)||h<0)throw Error("Invalid number in diff_fromDelta: "+o);var f=e.substring(a,a+=h);"="==l[s].charAt(0)?n[r++]=new i.Diff(0,f):n[r++]=new i.Diff(-1,f);break;default:if(l[s])throw Error("Invalid diff operation in diff_fromDelta: "+l[s])}}if(a!=e.length)throw Error("Delta length ("+a+") does not equal source text length ("+e.length+").");return n},i.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw Error("Null input. (match_main)");return(n=Math.max(0,Math.min(n,e.length)),e==t)?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},i.prototype.match_bitap_=function(e,t,n){if(t.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var r,i,a,l=this.match_alphabet_(t),s=this;function o(e,r){var i=e/t.length,a=Math.abs(n-r);return s.Match_Distance?i+a/s.Match_Distance:a?1:i}var c=this.Match_Threshold,h=e.indexOf(t,n);-1!=h&&(c=Math.min(o(0,h),c),-1!=(h=e.lastIndexOf(t,n+t.length))&&(c=Math.min(o(0,h),c)));var f=1<<t.length-1;h=-1;for(var p=t.length+e.length,d=0;d<t.length;d++){for(r=0,i=p;r<i;)o(d,n+i)<=c?r=i:p=i,i=Math.floor((p-r)/2+r);p=i;var u=Math.max(1,n-i+1),g=Math.min(n+i,e.length)+t.length,y=Array(g+2);y[g+1]=(1<<d)-1;for(var m=g;m>=u;m--){var k=l[e.charAt(m-1)];if(0===d?y[m]=(y[m+1]<<1|1)&k:y[m]=(y[m+1]<<1|1)&k|((a[m+1]|a[m])<<1|1)|a[m+1],y[m]&f){var v=o(d,m-1);if(v<=c){if(c=v,(h=m-1)>n)u=Math.max(1,2*n-h);else break}}}if(o(d+1,n)>c)break;a=y}return h},i.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(var n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},i.prototype.patch_addContext_=function(e,t){if(0!=t.length){if(null===e.start2)throw Error("patch not initialized");for(var n=t.substring(e.start2,e.start2+e.length1),r=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,n=t.substring(e.start2-r,e.start2+e.length1+r);r+=this.Patch_Margin;var a=t.substring(e.start2-r,e.start2);a&&e.diffs.unshift(new i.Diff(0,a));var l=t.substring(e.start2+e.length1,e.start2+e.length1+r);l&&e.diffs.push(new i.Diff(0,l)),e.start1-=a.length,e.start2-=a.length,e.length1+=a.length+l.length,e.length2+=a.length+l.length}},i.prototype.patch_make=function(e,t,n){if("string"==typeof e&&"string"==typeof t&&void 0===n)r=e,(a=this.diff_main(r,t,!0)).length>2&&(this.diff_cleanupSemantic(a),this.diff_cleanupEfficiency(a));else if(e&&"object"==typeof e&&void 0===t&&void 0===n)a=e,r=this.diff_text1(a);else if("string"==typeof e&&t&&"object"==typeof t&&void 0===n)r=e,a=t;else if("string"==typeof e&&"string"==typeof t&&n&&"object"==typeof n)r=e,a=n;else throw Error("Unknown call format to patch_make.");if(0===a.length)return[];for(var r,a,l=[],s=new i.patch_obj,o=0,c=0,h=0,f=r,p=r,d=0;d<a.length;d++){var u=a[d][0],g=a[d][1];switch(o||0===u||(s.start1=c,s.start2=h),u){case 1:s.diffs[o++]=a[d],s.length2+=g.length,p=p.substring(0,h)+g+p.substring(h);break;case -1:s.length1+=g.length,s.diffs[o++]=a[d],p=p.substring(0,h)+p.substring(h+g.length);break;case 0:g.length<=2*this.Patch_Margin&&o&&a.length!=d+1?(s.diffs[o++]=a[d],s.length1+=g.length,s.length2+=g.length):g.length>=2*this.Patch_Margin&&o&&(this.patch_addContext_(s,f),l.push(s),s=new i.patch_obj,o=0,f=p,c=h)}1!==u&&(c+=g.length),-1!==u&&(h+=g.length)}return o&&(this.patch_addContext_(s,f),l.push(s)),l},i.prototype.patch_deepCopy=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],a=new i.patch_obj;a.diffs=[];for(var l=0;l<r.diffs.length;l++)a.diffs[l]=new i.Diff(r.diffs[l][0],r.diffs[l][1]);a.start1=r.start1,a.start2=r.start2,a.length1=r.length1,a.length2=r.length2,t[n]=a}return t},i.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var r=0,i=[],a=0;a<e.length;a++){var l=e[a].start2+r,s=this.diff_text1(e[a].diffs),o=-1;if(s.length>this.Match_MaxBits?-1!=(h=this.match_main(t,s.substring(0,this.Match_MaxBits),l))&&(-1==(o=this.match_main(t,s.substring(s.length-this.Match_MaxBits),l+s.length-this.Match_MaxBits))||h>=o)&&(h=-1):h=this.match_main(t,s,l),-1==h)i[a]=!1,r-=e[a].length2-e[a].length1;else if(i[a]=!0,r=h-l,f=-1==o?t.substring(h,h+s.length):t.substring(h,o+this.Match_MaxBits),s==f)t=t.substring(0,h)+this.diff_text2(e[a].diffs)+t.substring(h+s.length);else{var c=this.diff_main(s,f,!1);if(s.length>this.Match_MaxBits&&this.diff_levenshtein(c)/s.length>this.Patch_DeleteThreshold)i[a]=!1;else{this.diff_cleanupSemanticLossless(c);for(var h,f,p,d=0,u=0;u<e[a].diffs.length;u++){var g=e[a].diffs[u];0!==g[0]&&(p=this.diff_xIndex(c,d)),1===g[0]?t=t.substring(0,h+p)+g[1]+t.substring(h+p):-1===g[0]&&(t=t.substring(0,h+p)+t.substring(h+this.diff_xIndex(c,d+g[1].length))),-1!==g[0]&&(d+=g[1].length)}}}}return[t=t.substring(n.length,t.length-n.length),i]},i.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",r=1;r<=t;r++)n+=String.fromCharCode(r);for(var r=0;r<e.length;r++)e[r].start1+=t,e[r].start2+=t;var a=e[0],l=a.diffs;if(0==l.length||0!=l[0][0])l.unshift(new i.Diff(0,n)),a.start1-=t,a.start2-=t,a.length1+=t,a.length2+=t;else if(t>l[0][1].length){var s=t-l[0][1].length;l[0][1]=n.substring(l[0][1].length)+l[0][1],a.start1-=s,a.start2-=s,a.length1+=s,a.length2+=s}if(0==(l=(a=e[e.length-1]).diffs).length||0!=l[l.length-1][0])l.push(new i.Diff(0,n)),a.length1+=t,a.length2+=t;else if(t>l[l.length-1][1].length){var s=t-l[l.length-1][1].length;l[l.length-1][1]+=n.substring(0,s),a.length1+=s,a.length2+=s}return n},i.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=t)){var r=e[n];e.splice(n--,1);for(var a=r.start1,l=r.start2,s="";0!==r.diffs.length;){var o=new i.patch_obj,c=!0;for(o.start1=a-s.length,o.start2=l-s.length,""!==s&&(o.length1=o.length2=s.length,o.diffs.push(new i.Diff(0,s)));0!==r.diffs.length&&o.length1<t-this.Patch_Margin;){var h=r.diffs[0][0],f=r.diffs[0][1];1===h?(o.length2+=f.length,l+=f.length,o.diffs.push(r.diffs.shift()),c=!1):-1===h&&1==o.diffs.length&&0==o.diffs[0][0]&&f.length>2*t?(o.length1+=f.length,a+=f.length,c=!1,o.diffs.push(new i.Diff(h,f)),r.diffs.shift()):(f=f.substring(0,t-o.length1-this.Patch_Margin),o.length1+=f.length,a+=f.length,0===h?(o.length2+=f.length,l+=f.length):c=!1,o.diffs.push(new i.Diff(h,f)),f==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(f.length))}s=(s=this.diff_text2(o.diffs)).substring(s.length-this.Patch_Margin);var p=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);""!==p&&(o.length1+=p.length,o.length2+=p.length,0!==o.diffs.length&&0===o.diffs[o.diffs.length-1][0]?o.diffs[o.diffs.length-1][1]+=p:o.diffs.push(new i.Diff(0,p))),c||e.splice(++n,0,o)}}},i.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},i.prototype.patch_fromText=function(e){var t=[];if(!e)return t;for(var n=e.split("\n"),r=0,a=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<n.length;){var l=n[r].match(a);if(!l)throw Error("Invalid patch string: "+n[r]);var s=new i.patch_obj;for(t.push(s),s.start1=parseInt(l[1],10),""===l[2]?(s.start1--,s.length1=1):"0"==l[2]?s.length1=0:(s.start1--,s.length1=parseInt(l[2],10)),s.start2=parseInt(l[3],10),""===l[4]?(s.start2--,s.length2=1):"0"==l[4]?s.length2=0:(s.start2--,s.length2=parseInt(l[4],10)),r++;r<n.length;){var o=n[r].charAt(0);try{var c=decodeURI(n[r].substring(1))}catch(h){throw Error("Illegal escape in patch_fromText: "+c)}if("-"==o)s.diffs.push(new i.Diff(-1,c));else if("+"==o)s.diffs.push(new i.Diff(1,c));else if(" "==o)s.diffs.push(new i.Diff(0,c));else if("@"==o)break;else if(""===o);else throw Error('Invalid patch mode "'+o+'" in: '+c);r++}}return t},i.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},i.patch_obj.prototype.toString=function(){e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1;for(var e,t,n=["@@ -"+e+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],r=0;r<this.diffs.length;r++){switch(this.diffs[r][0]){case 1:t="+";break;case -1:t="-";break;case 0:t=" "}n[r+1]=t+encodeURI(this.diffs[r][1])+"\n"}return n.join("").replace(/%20/g," ")},r.exports=i,r.exports.diff_match_patch=i,r.exports.DIFF_DELETE=-1,r.exports.DIFF_INSERT=1,r.exports.DIFF_EQUAL=0;let eu=new ep.exports.diff_match_patch;function eg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=eu.patch_make(e,t).map(e=>e.toString()).join("");return{type:"diffMatchPatch",path:n,value:r}}function ey(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return{type:"insert",path:n,position:t,items:e}}function em(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{type:"set",path:t,value:e}}function ek(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{type:"unset",path:e}}function ev(e,t,n){let r=null,i=!0,a=[t.span.name,...t.inlineObjects.map(e=>e.name)],l=[t.block.name,...t.blockObjects.map(e=>e.name)];return void 0===e?{valid:!0,resolution:null}:Array.isArray(e)&&0!==e.length?(e.some((e,s)=>{if(!L()(e))return r={patches:[ek([s])],description:"Block must be an object, got ".concat(String(e)),action:"Unset invalid item",item:e},!0;if(!e._key)return r={patches:[em(ef(ef({},e),{},{_key:n()}),[s])],description:"Block at index ".concat(s," is missing required _key."),action:"Set the block with a random _key value",item:e},!0;if(!e._type||!l.includes(e._type)){if("block"===e._type){let o=t.block.name;return r={patches:[em(ef(ef({},e),{},{_type:o}),[{_key:e._key}])],description:"Block with _key '".concat(e._key,"' has invalid type name '").concat(e._type,"'. According to the schema, the block type name is '").concat(o,"'"),action:"Use type '".concat(o,"'"),item:e},!0}return r={patches:[ek([{_key:e._key}])],description:"Block with _key '".concat(e._key,"' has invalid _type '").concat(e._type,"'"),action:"Remove the block",item:e},!0}if(e._type===t.block.name){if(!e.children)return r={patches:[ek([{_key:e._key}])],description:"Text block with _key '".concat(e._key,"' is missing required key 'children'."),action:"Remove the block",item:e},!0;if(!e.markDefs)return r={patches:[em(ef(ef({},e),{},{markDefs:[]}),[{_key:e._key}])],description:"Block is missing required key 'markDefs'.",action:"Add empty markDefs array",item:e},!0;let c=S()(P()(e.children.filter(e=>e._type===t.span.name).map(e=>e.marks||[]))),h=c.filter(e=>!t.decorators.map(e=>e.value).includes(e)),f=h.filter(t=>!!e.markDefs&&!e.markDefs.find(e=>e._key===t));if(f.length>0){let p=e.children.filter(e=>e._type===t.span.name&&Array.isArray(e.marks)&&e.marks.some(e=>f.includes(e)));if(p)return r={patches:p.map(t=>em((t.marks||[]).filter(e=>!f.includes(e)),[{_key:e._key},"children",{_key:t._key},"marks"])),description:"Block with _key '".concat(e._key,"' contains marks (").concat(f.join(", "),") not supported by the current content model."),action:"Remove invalid marks",item:e},!0}if(e.children&&0===e.children.length){let d={_type:t.span.name,_key:n(),text:""};return r={patches:[ey([d],"after",[{_key:e._key},"children",0])],description:"Children for text block with _key '".concat(e._key,"' is empty."),action:"Insert an empty text",item:e},!0}e.children.some((i,l)=>{if(!i._key){let s=ef(ef({},i),{},{_key:n()});return r={patches:[em(s,[{_key:e._key},"children",l])],description:"Child at index ".concat(l," is missing required _key in block with _key ").concat(e._key,"."),action:"Set a new random _key on the object",item:e},!0}return i._type&&!1!==a.includes(i._type)?i._type===t.span.name&&void 0===i.text&&(r={patches:[em(ef(ef({},i),{},{text:""}),[{_key:e._key},"children",{_key:i._key}])],description:"Child with _key '".concat(i._key,"' in block with key '").concat(e._key,"' is missing text property!"),action:"Write an empty .text to the object",item:e},!0):(r={patches:[ek([{_key:e._key},"children",{_key:i._key}])],description:"Child with _key '".concat(i._key,"' in block with key '").concat(e._key,"' has invalid '_type' property (").concat(i._type,")."),action:"Remove the object",item:e},!0)})&&(i=!1)}return!1})&&(i=!1),{valid:i,resolution:r}):{valid:!1,resolution:{patches:[ek([])],description:"Editor value must be an array of Portable Text blocks, or undefined.",action:"Unset the value",item:e}}}let e_="sanity-pte:";function eb(e){let t="".concat(e_).concat(e);return R()&&R().enabled(t)?R()(t):R()(e_)}R()(e_);let ex=[];function ew(e,t){let n=t[e._key];return n&&M()(e,n)?n:(t[e._key]=e,e)}function eM(e,t){let{schemaTypes:n}=t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e&&Array.isArray(e)?e.map(e=>{let{_type:t,_key:i}=e,a=ec(e,et),l=[{_key:"".concat(i,"-void-child"),_type:"span",text:"",marks:[]}],s=e&&e._type===n.block.name;if(s){let o=!1,c=void 0===e.style,h=void 0===e.markDefs,f=e.children.map(e=>{let{_type:t,_key:n}=e,i=ec(e,en);return"span"!==t?(o=!0,ew({_type:t,_key:n,children:l,value:i,__inline:!0},r)):e});return!c&&!h&&!o&&_.W_.isElement(e)?e:(c&&(a.style=n.styles[0].value),h&&(a.markDefs=ex),ew(ef(ef({_type:t,_key:i},a),{},{children:f}),r))}return ew({_type:t,_key:i,children:l,value:a},r)}):[]}function eE(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.map(e=>{let{_key:r,_type:i}=e;if(!r||!i)throw Error("Not a valid block");if(i===t&&"children"in e&&Array.isArray(e.children)&&r){let a=!1,l=e.children.map(e=>{let{_type:t}=e;if("value"in e&&"span"!==t){a=!0;let{value:r,_key:i,_type:l,__inline:s,children:o}=e,c=ec(e,er);return ew(ef(ef(ef({},c),r),{},{_key:i,_type:l}),n)}return e});return a?ew(ef(ef({},e),{},{children:l,_key:r,_type:i}),n):e}let s="value"in e&&e.value;return ew(ef({_key:r,_type:i},"object"==typeof s?s:{}),n)})}function eT(e,t){return void 0===e||e&&Array.isArray(e)&&0===e.length||e&&Array.isArray(e)&&1===e.length&&_.W_.isElement(e[0])&&e[0]._type===t.block.name&&"style"in e[0]&&e[0].style===t.styles[0].value&&Array.isArray(e[0].children)&&1===e[0].children.length&&_.xv.isText(e[0].children[0])&&"span"===e[0].children[0]._type&&""===e[0].children[0].text}let eN=new WeakMap,eD=new WeakMap,eA=new WeakMap,eP=new WeakMap,eI=new WeakMap,eL=new WeakMap,eC=new WeakMap,eS=new WeakMap,eO=new WeakMap,eR=(0,h.createContext)(null),eB=()=>{let e=(0,h.useContext)(eR);if(!e)throw Error("The `usePortableTextEditor` hook must be used inside the <PortableTextEditor> component's context.");return e},ej=(0,h.createContext)(null),eY=()=>{let e=(0,h.useContext)(ej);if(void 0===e)throw Error("The `usePortableTextEditorSelection` hook must be used inside the <PortableTextEditor> component's context.");return e},eW=(0,h.createContext)(!1),eJ=()=>{let e=(0,h.useContext)(eW);if(void 0===e)throw Error("The `usePortableTextEditorReadOnly` hook must be used inside the <PortableTextEditor> component's context.");return e},eV=(0,h.createContext)(void 0),ez=eb("operationToPatches");function eF(e,t,n){let r;let i=[e.path[0]];if(!t)return null;let a=t[i[0]];if(!a)return null;let l=[{_key:a._key}];if(a._type!==n.block.name)return l;let s=e.path.slice(0,2),o=Array.isArray(a.children)&&a.children[s[1]];return o&&(r=["children",{_key:o._key}]),r?[...l,...r]:l}function eU(e,t){if(!t)return[];let[n,r]=Array.from(_.ML.nodes(t,{at:[],match:t=>(0,z.Fd)(e.path[0])&&t._key===e.path[0]._key}))[0]||[void 0,void 0];if(!n||!_.W_.isElement(n))return[];if(t.isVoid(n))return r;let i=[e.path[2]],a=n.children.findIndex(e=>M()([{_key:e._key}],i));if(a>=0&&n.children[a]){let l=n.children[a];return _.W_.isElement(l)&&t.isVoid(l)?r.concat(a).concat(0):r.concat(a)}return r}function e$(e,t,n){if(!t)return null;let r=null,i=null,a=t.anchor&&eF(t.anchor,e,n);a&&t.anchor&&(r={path:a,offset:t.anchor.offset});let l=t.focus&&eF(t.focus,e,n);return l&&t.focus&&(i={path:l,offset:t.focus.offset}),r&&i?{anchor:r,focus:i}:null}function eH(e,t){if(!e||!t)return null;let n={path:eU(e.anchor,t),offset:e.anchor.offset},r={path:eU(e.focus,t),offset:e.focus.offset};return n&&r?{anchor:n,focus:r}:null}let eq=eb("API:editable"),eZ=new WeakMap,eG=new WeakMap;function eX(e,t){let n=eG.get(e);eG.set(e,!1),t(),eG.set(e,n)}let eK="before",eQ="after";function e0(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>e.concat(t),[])}let e1=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty),e2={replace:(e,t)=>t,set:(e,t)=>t,setIfMissing:(e,t)=>void 0===e?t:e,unset(e,t){},inc:(e,t)=>e+t,dec:(e,t)=>e-t},e3=Object.keys(e2),e6=new ep.exports.diff_match_patch,e9={replace:(e,t)=>t,set:(e,t)=>t,setIfMissing:(e,t)=>void 0===e?t:e,unset(e,t){},diffMatchPatch:(e,t)=>e6.patch_apply(e6.patch_fromText(t),e)[0]},e5=Object.keys(e9);function e4(e,t){let n=Array.isArray(e)?function(e,t){let n=e.slice();if(0===t.path.length){if("setIfMissing"===t.type){if(!Array.isArray(t.value))throw Error("Cannot set value of an array to a non-array");return void 0===e?t.value:e}if("set"===t.type){if(!Array.isArray(t.value))throw Error("Cannot set value of an array to a non-array");return t.value}if("unset"===t.type)return;if("move"===t.type){if(!t.value||!e1(t.value,"from")||!e1(t.value,"to"))throw Error('Invalid value of \'move\' patch. Expected a value with "from" and "to" indexes, instead got: '.concat(JSON.stringify(t.value)));return function(e,t,n){let r=e.slice(),i=r[t];return r.splice(t,1),r.splice(n,0,i),r}(n,t.value.from,t.value.to)}throw Error("Invalid array operation: ".concat(t.type))}let[r,...i]=t.path,a=function(e,t){if("number"==typeof t)return t;let n=H()(e,t);return -1!==n&&n}(e,r);if(!1===a)return n;if(0===i.length){if("insert"===t.type){let{position:l,items:s}=t;return function(e,t,n){if(t!==eK&&t!==eQ)throw Error('Invalid position "'.concat(t,'", must be either ').concat(eK," or ").concat(eQ));for(var r=arguments.length,i=Array(r>3?r-3:0),a=3;a<r;a++)i[a-3]=arguments[a];let l=e0(...i);if(0===e.length)return l;let s=e.length,o=Math.abs((s+n)%s)%s,c=e.slice();return c.splice("after"===t?o+1:o,0,...e0(l)),c}(e,l,a,s)}if("unset"===t.type){if("number"!=typeof a)throw Error('Expected array index to be a number, instead got "'.concat(a,'"'));return n.splice(a,1),n}}return n[a]=e4(n[a],ef(ef({},t),{},{path:i})),n}(e,t):U()(e)?function(e,t){if(!e5.includes(t.type))throw Error('Received patch of unsupported type: "'.concat(JSON.stringify(t.type),'" for string. This is most likely a bug.'));if(t.path.length>0)throw Error('Cannot apply deep operations on string values. Received patch with type "'.concat(t.type,'" and path "').concat(t.path.join("."),' that targeted the value "').concat(JSON.stringify(e),'"'));let n=e9[t.type];if(n)return n(e,t.value);throw Error("Unknown patch type")}(e,t):L()(e)?function(e,t){let n=X()(e);if(0===t.path.length){if("set"===t.type){if(!L()(t.value))throw Error("Cannot set value of an object to a non-object");return t.value}if("unset"===t.type)return;if("setIfMissing"===t.type)return void 0===e?t.value:e;throw Error("Invalid object operation: ".concat(t.type))}let[r,...i]=t.path;if("string"!=typeof r)throw Error("Expected field name to be a string, instad got: ".concat(r));return 0===i.length&&"unset"===t.type?Z()(n,r):(n[r]=e4(n[r],ef(ef({},t),{},{path:i})),n)}(e,t):function(e,t){if(!e3.includes(t.type))throw Error('Received patch of unsupported type: "'.concat(JSON.stringify(t.type),'" for primitives. This is most likely a bug.'));if(t.path.length>0)throw Error('Cannot apply deep operations on primitive values. Received patch with type "'.concat(t.type,'" and path "').concat(t.path.map(e=>JSON.stringify(e)).join("."),' that targeted the value "').concat(JSON.stringify(e),'"'));return e2[t.type](e,t.value)}(e,t);return n}let e7=eb("operationToPatches"),e8=new ep.exports.diff_match_patch;function te(e){return"object"==typeof e&&"_key"in e}function tt(e){let t=null;return e.concat("").reverse().forEach(e=>{te(e)&&(t=e._key)}),t}function tn(e,t){e7("Children ".concat(t,":"),JSON.stringify(e.children,null,2)),e7("Selection ".concat(t,": "),JSON.stringify(e.selection,null,2))}let tr=eb("plugin:withUndoRedo"),ti=new ep.exports.diff_match_patch,ta=new WeakMap,tl=new WeakMap,ts=e=>tl.get(e),to=e=>!!eG.get(e)&&ta.get(e);function tc(e,t,n){let r=ef({},n);if("insert"===t.type&&1===t.path.length)return[th(e,t,n,t.items.length)];if("unset"===t.type&&1===t.path.length)return[th(e,t,n,-1)];if("unset"===t.type&&0===t.path.length)return tr("Adjusting selection for unset everything patch and ".concat(n.type," operation")),[n];if("diffMatchPatch"===t.type){let i=e.children.findIndex(e=>M()({_key:e._key},t.path[0])),a=e.children[i];if(_.W_.isElement(a)&&Array.isArray(a.children)){let l=a.children.findIndex(e=>M()({_key:e._key},t.path[2])),s=ti.patch_fromText(t.value)[0];if(!s)return tr("Could not parse diffMatchPatch",t),[n];let o=s.length2-s.length1,c=s.diffs.some(e=>-1===e[0]);if("split_node"===n.type&&n.path.length>1){let h=r;return c?h.position-=o:h.position+=o,[h]}if(("insert_text"===n.type||"remove_text"===n.type)&&_.y$.isPath(n.path)&&void 0!==n.path[0]&&n.path[0]===i&&n.path[1]===l){if("insert_text"===n.type){let f=0;for(let p of s.diffs)if(0===p[0]&&(f=p[1].length),1===p[0])break;if(null!==s.start1&&f+s.start1<=n.offset){let d=r;d.offset+=o,r=d}return[r]}if("remove_text"===n.type){let u=0;for(let g of s.diffs)if(0===g[0]&&(u=g[1].length),-1===g[0])break;if(null!==s.start1&&u+s.start1<=n.offset){let y=r;y.offset-=o,r=y}return[r]}}}}return[n]}function th(e,t,n,r){let i=e.children.findIndex(e=>M()({_key:e._key},t.path[0]));if(i>=0&&"set_selection"!==n.type&&Array.isArray(n.path)&&void 0!==n.path[0]&&n.path[0]>=i+r){let a=ef({},n),l=[n.path[0]+r,...n.path.slice(1)];return tr("Adjusting ".concat(n.type," for block ").concat(t.type),n.path,l),a.path=l,a}return n}let tf=(e,t)=>!!("set_selection"===e.type||t&&"insert_text"===e.type&&"insert_text"===t.type&&e.offset===t.offset+t.text.length&&_.y$.equals(e.path,t.path)&&" "!==e.text||t&&"remove_text"===e.type&&"remove_text"===t.type&&e.offset+e.text.length===t.offset&&_.y$.equals(e.path,t.path)),tp=(e,t)=>"set_selection"!==e.type||null!==e.newProperties,td=(e,t)=>!!t&&"set_selection"===e.type&&"set_selection"===t.type,tu=e=>"set_selection"!==e.type;function tg(e,t){let n=to(e);ta.set(e,!1),t(),ta.set(e,n)}let ty=eb("plugin:withPatches"),tm=eb("plugin:withPlaceholderBlock"),tk=eb("plugin:withPortableTextBlockStyle"),tv=eb("plugin:withPortableTextLists"),t_=eb("plugin:withPortableTextMarkModel"),tb=eb("plugin:withPortableTextSelections"),tx=eb("plugin:withSchemaTypes"),tw=eb("plugin:withUtils"),tM=eb("plugin:withHotKeys"),tE={marks:{"mod+b":"strong","mod+i":"em","mod+u":"underline","mod+'":"code"},custom:{}},tT=eb("plugin:withInsertData"),tN={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function tD(e,t){if(!e.selection)return!1;let[n,r]=_.ML.node(e,e.selection,{depth:1});if(e.isTextBlock(n)&&e.isTextBlock(t[0])){let{markDefs:i}=n;return tT("Mixing markDefs of focusBlock and fragments[0] block",i,t[0].markDefs),_.YR.setNodes(e,{markDefs:[...t[0].markDefs||[],...i||[]]},{at:r,mode:"lowest",voids:!1}),!0}return!1}let tA=new WeakMap,tP=(e,t)=>{let n=e,{portableTextEditor:r}=t,{schemaTypes:i,keyGenerator:a,readOnly:l,change$:s,syncValue:o,incomingPatches$:c}=r;n.maxBlocks=r.maxBlocks||-1,n.readOnly=r.readOnly||!1,n.destroy?n.destroy():tA.set(n,{apply:n.apply,onChange:n.onChange,normalizeNode:n.normalizeNode});let h=function(e){let t=e.block.name;return{insertNodePatch:function(e,n,r){let i=r[n.path[0]];if(1===n.path.length){let a=0===n.path[0]?"before":"after",l=r[n.path[0]-1],s=0===n.path[0]?null==i?void 0:i._key:null==l?void 0:l._key;return s?[ey([eE([n.node],t)[0]],a,[{_key:s}])]:[ed(r,[]),ey([eE([n.node],t)[0]],"before",[n.path[0]])]}if(2===n.path.length&&e.children[n.path[0]]){if(!e.isTextBlock(i))throw Error("Invalid block");let o=0!==i.children.length&&i.children[n.path[1]-1]?"after":"before",c=eE([{_key:"bogus",_type:t,children:[n.node]}],t)[0],h=c.children[0];return[ey([h],o,[{_key:i._key},"children",i.children.length<=1||!i.children[n.path[1]-1]?0:{_key:i.children[n.path[1]-1]._key}])]}throw Error("Unexpected path encountered: ".concat(JSON.stringify(n.path)," - ").concat(JSON.stringify(r)))},insertTextPatch:function(e,t,n){ez("Operation",JSON.stringify(t,null,2));let r=e.isTextBlock(e.children[t.path[0]])&&e.children[t.path[0]];if(!r)throw Error("Could not find block");let i=e.isTextBlock(r)&&e.isTextSpan(r.children[t.path[1]])&&r.children[t.path[1]];if(!i)throw Error("Could not find child");let a=[{_key:r._key},"children",{_key:i._key},"text"],l=n[t.path[0]],s=e.isTextBlock(l)&&l.children[t.path[1]],o=e.isTextSpan(s)?s.text:"",c=eg(o,i.text,a);return c.value.length?[c]:[]},mergeNodePatch:function(e,n,r){let i=[];if(1===n.path.length){let a=r[n.path[0]],l=a&&a._key;if(l){let s=eE([e.children[n.path[0]-1]],t)[0];i.push(em(s,[{_key:s._key}])),i.push(ek([{_key:l}]))}else throw Error("Target key not found!")}else if(2===n.path.length){let o=r[n.path[0]],c=e.isTextBlock(o)&&o.children[n.path[1]]||void 0,h=e.children[n.path[0]];if(!e.isTextBlock(h))throw Error("Invalid block");let f=h.children[n.path[1]-1];e.isTextSpan(f)&&(i.push(em(f.text,[{_key:o._key},"children",{_key:f._key},"text"])),c&&i.push(ek([{_key:o._key},"children",{_key:c._key}])))}else throw Error("Unexpected path encountered: ".concat(JSON.stringify(n.path)));return i},moveNodePatch:function(e,n,r){let i=[],a=r[n.path[0]],l=r[n.newPath[0]];if(1===n.path.length){let s=n.path[0]>n.newPath[0]?"before":"after";i.push(ek([{_key:a._key}])),i.push(ey([eE([a],t)[0]],s,[{_key:l._key}]))}else if(2===n.path.length&&e.isTextBlock(a)&&e.isTextBlock(l)){let o=a.children[n.path[1]],c=l.children[n.newPath[1]],h=n.newPath[1]===l.children.length?"after":"before",f=eE([a],t)[0].children[n.path[1]];i.push(ek([{_key:a._key},"children",{_key:o._key}])),i.push(ey([f],h,[{_key:l._key},"children",{_key:c._key}]))}return i},removeNodePatch:function(e,t,n){let r=n[t.path[0]];if(1===t.path.length){if(r&&r._key)return[ek([{_key:r._key}])];throw Error("Block not found")}if(2===t.path.length){let i=e.isTextBlock(r)&&r.children&&r.children[t.path[1]];return i?[ek([{_key:r._key},"children",{_key:i._key}])]:(ez("Span not found in editor trying to remove node"),[])}throw Error("Unexpected path encountered: ".concat(JSON.stringify(t.path)))},removeTextPatch:function(e,t,n){let r=e&&e.children[t.path[0]];if(!r)throw Error("Could not find block");let i=e.isTextBlock(r)&&r.children[t.path[1]]||void 0,a=e.isTextSpan(i)?i:void 0;if(i&&!a)throw Error("Expected span");if(!a)throw Error("Could not find child");let l=[{_key:r._key},"children",{_key:a._key},"text"],s=n[t.path[0]],o=e.isTextBlock(s)&&s.children[t.path[1]],c=e.isTextSpan(o)&&o.text,h=eg(c||"",a.text,l);return h.value?[h]:[]},setNodePatch:function(e,n){if(1===n.path.length){let r=e.children[n.path[0]];if("string"!=typeof r._key)throw Error("Expected block to have a _key");let i=j()(ef(ef({},e.children[n.path[0]]),n.newProperties),W());return[em(eE([i],t)[0],[{_key:r._key}])]}if(2===n.path.length){let a=e.children[n.path[0]];if(e.isTextBlock(a)){let l=a.children[n.path[1]];if(l){let s=a._key,o=l._key,c=[];return Object.keys(n.newProperties).forEach(e=>{let t=V()(n.newProperties,e);c.push(em(t,[{_key:s},"children",{_key:o},e]))}),c}throw Error("Could not find a valid child")}throw Error("Could not find a valid block")}throw Error("Unexpected path encountered: ".concat(JSON.stringify(n.path)))},splitNodePatch:function(e,n,r){let i=[],a=e.children[n.path[0]];if(!e.isTextBlock(a))throw Error("Block with path ".concat(JSON.stringify(n.path[0])," is not a text block and can't be split"));if(1===n.path.length){let l=r[n.path[0]];if(e.isTextBlock(l)){let s=eE([e.children[n.path[0]+1]],t)[0];if(s){i.push(ey([s],"after",[{_key:a._key}]));let o=l.children.slice(n.position);o.forEach(e=>{let t=[{_key:l._key},"children",{_key:e._key}];i.push(ek(t))})}}return i}if(2===n.path.length){let c=a.children[n.path[1]];if(e.isTextSpan(c)){let h=eE([ef(ef({},a),{},{children:a.children.slice(n.path[1]+1,n.path[1]+2)})],t)[0].children;i.push(ey(h,"after",[{_key:a._key},"children",{_key:c._key}])),i.push(em(c.text,[{_key:a._key},"children",{_key:c._key},"text"]))}}return i}}}(i),f=function(e){eZ.set(e,!1);let{apply:t,normalizeNode:n}=e;return e.apply=n=>{if("split_node"===n.type&&(n.properties=ef(ef({},n.properties),{},{_key:a()})),"insert_node"===n.type){let r=!eZ.get(e)||!("_key"in n.node);_.ML.isEditor(n.node)||(n.node=ef(ef({},n.node),r?{_key:a()}:{}))}t(n)},e.normalizeNode=t=>{let[r,l]=t;if(_.W_.isElement(r)&&r._type===i.block.name){for(let[s,o]of(r._key||_.YR.setNodes(e,{_key:a()},{at:l}),_.NB.children(e,l)))if(!s._key){_.YR.setNodes(e,{_key:a()},{at:o});return}}n(t)},e},p=function(e){e.isTextBlock=e=>(0,z.DG)(e)&&e._type===i.block.name,e.isTextSpan=e=>(0,z.NG)(e)&&e._type==i.span.name,e.isListBlock=e=>(0,z.KA)(e)&&e._type===i.block.name,e.isVoid=e=>i.block.name!==e._type&&(i.blockObjects.map(e=>e.name).includes(e._type)||i.inlineObjects.map(e=>e.name).includes(e._type)),e.isInline=e=>{let t=i.inlineObjects.map(e=>e.name);return t.includes(e._type)&&"__inline"in e&&!0===e.__inline};let{apply:t}=e;return e.apply=e=>{let n="insert_node"===e.type&&2===e.path.length&&_.xv.isText(e.node)&&void 0===e.node._type;if(n){let r=ef(ef({},e.node),{},{_type:"span"});e.node=r,tx("Setting span type to child without a type",e)}t(e)},e},d=function(e){return r.setEditable({focus:()=>{if(!e.selection){let t={path:[0,0],offset:0};_.YR.select(e,{focus:t,anchor:t}),e.onChange()}N.F3.focus(e)},blur:()=>{N.F3.blur(e)},toggleMark:t=>{e.pteToggleMark(t)},toggleList:t=>{e.pteToggleListItem(t)},toggleBlockStyle:t=>{e.pteToggleBlockStyle(t)},isMarkActive:t=>{try{return e.pteIsMarkActive(t)}catch(n){return console.warn(n),!1}},marks:()=>ef({},_.ML.marks(e)||{}).marks||[],undo:()=>e.undo(),redo:()=>e.redo(),select:t=>{let n=eH(t,e);n?_.YR.select(e,n):_.YR.deselect(e),e.onChange()},focusBlock:()=>{if(e.selection)try{let[t]=Array.from(_.ML.nodes(e,{at:e.selection.focus,match:t=>_.ML.isBlock(e,t)}))[0]||[void 0];if(t)return eE([t],i.block.name,eS.get(e))[0]}catch(n){}},focusChild:()=>{if(e.selection)try{let[t]=Array.from(_.ML.nodes(e,{mode:"lowest",at:e.selection.focus,match:e=>void 0!==e._type,voids:!0}))[0]||[void 0];if(t&&!_.ML.isBlock(e,t)){let n={_key:"pseudo",_type:i.block.name,children:[t]},r=eE([n],i.block.name,eS.get(e));if(e.isTextBlock(r[0]))return r[0].children[0]}}catch(a){}},insertChild:(t,n)=>{var l;if(!e.selection)throw Error("The editor has no selection");let[s]=Array.from(_.ML.nodes(e,{at:e.selection.focus,match:t=>_.ML.isBlock(e,t)}))[0]||[void 0];if(!s)throw Error("No focus block");if(s&&_.ML.isVoid(e,s))throw Error("Can't insert childs into block objects");let o=eM([{_key:a(),_type:i.block.name,children:[ef({_key:a(),_type:t.name},n||{})]}],r)[0],c=o.children[0];return _.ML.insertNode(e,c),e.onChange(),(null==(l=e$(eE(e.children,i.block.name,eS.get(e)),e.selection,i))?void 0:l.focus.path)||[]},insertBlock:(t,n)=>{var l;if(!e.selection)throw Error("The editor has no selection");let s=eM([ef({_key:a(),_type:t.name},n||{})],r)[0];return _.ML.insertNode(e,s),e.onChange(),(null==(l=e$(eE(e.children,i.block.name,eS.get(e)),e.selection,i))?void 0:l.focus.path)||[]},hasBlockStyle:t=>{try{return e.pteHasBlockStyle(t)}catch(n){return!1}},hasListStyle:t=>{try{return e.pteHasListStyle(t)}catch(n){return!1}},isVoid:e=>![i.block.name,i.span.name].includes(e._type),findByPath:t=>{let n=eH({focus:{path:t,offset:0},anchor:{path:t,offset:0}},e);if(n){let[r,a]=_.ML.node(e,n.focus.path.slice(0,1));if(r&&a&&"string"==typeof r._key){if(1===t.length&&1===n.focus.path.length)return[eE([r],i.block.name)[0],[{_key:r._key}]];let l=eE([r],i.block.name,eS.get(e))[0];if(e.isTextBlock(l)){let s=l.children[n.focus.path[1]];if(s)return[s,[{_key:r._key},"children",{_key:s._key}]]}}}return[void 0,void 0]},findDOMNode:t=>{let n;try{let[r]=Array.from(_.ML.nodes(e,{at:[],match:e=>e._key===t._key})||[])[0]||[void 0];n=N.F3.toDOMNode(e,r)}catch(i){}return n},activeAnnotations:()=>{var t;if(!e.selection||e.selection.focus.path.length<2)return[];try{let n=[],r=_.ML.nodes(e,{at:e.selection,match:e=>_.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0});for(let[i,a]of r){let[l]=_.ML.node(e,a,{depth:1});e.isTextBlock(l)&&(null==(t=l.markDefs)||t.forEach(e=>{_.xv.isText(i)&&i.marks&&Array.isArray(i.marks)&&i.marks.includes(e._key)&&n.push(e)}))}return n}catch(s){return[]}},addAnnotation:(t,n)=>{let{selection:r}=e;if(r){let[l]=_.ML.node(e,r.focus,{depth:1});if(_.W_.isElement(l)&&l._type===i.block.name){let s=a();if(e.isTextBlock(l)){_.YR.setNodes(e,{markDefs:[...l.markDefs||[],ef({_type:t.name,_key:s},n)]},{at:r.focus}),e.onChange(),_.e6.isCollapsed(r)&&(e.pteExpandToWord(),e.onChange());let[o]=_.ML.node(e,r.focus,{depth:2});if(e.selection){_.ML.withoutNormalizing(e,()=>{_.YR.setNodes(e,{},{match:_.xv.isText,split:!0}),e.selection&&_.xv.isText(o)&&(_.YR.setNodes(e,{marks:[...o.marks||[],s]},{at:e.selection,match:e=>e._type===i.span.name}),e.onChange())}),_.ML.normalize(e),e.onChange();let c=e$(eE(e.children,i.block.name,eS.get(e)),e.selection,i);if(c&&"string"==typeof l._key)return _.ML.withoutNormalizing(e,()=>{e.selection&&(_.YR.insertNodes(e,[{_type:"span",text:"",marks:[],_key:a()}],{at:_.e6.end(e.selection)}),e.onChange())}),{spanPath:c.focus.path,markDefPath:[{_key:l._key},"markDefs",{_key:s}]}}}}}},delete:(t,n)=>{if(t){let r=eH(t,e);if(r){if(!(null==n?void 0:n.mode)||(null==n?void 0:n.mode)==="selected"){eq("Deleting content in selection"),_.YR.delete(e,{at:r,hanging:!0,voids:!0}),e.onChange();return}let a=_.ML.nodes(e,{at:r,match:t=>(null==n?void 0:n.mode)==="blocks"?(eq("Deleting blocks touched by selection"),e.isTextBlock(t)||!e.isTextBlock(t)&&_.W_.isElement(t)):(eq("Deleting children touched by selection"),t._type===i.span.name||!e.isTextBlock(t)&&_.W_.isElement(t))}),l=[...a];l.forEach(t=>{let[,n]=t;_.YR.removeNodes(e,{at:n,voids:!0,hanging:!0})}),e.onChange()}}},removeAnnotation:t=>{let{selection:n}=e;if(eq("Removing annotation",t),n){if(_.e6.isCollapsed(n)){let[r,i]=_.ML.node(e,n,{depth:2});_.xv.isText(r)&&r.marks&&"string"==typeof r.text&&(_.YR.select(e,i),n=e.selection)}_.ML.withoutNormalizing(e,()=>{if(n&&_.e6.isExpanded(n)){if(!(n=e.selection))return;_.YR.setNodes(e,{},{match:_.xv.isText,split:!0}),e.onChange();let r=[..._.ML.nodes(e,{at:n,match:e=>_.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0})];r.forEach(n=>{var r;let[i,a]=n,[l]=_.ML.node(e,a,{depth:1});e.isTextBlock(l)&&(null==(r=l.markDefs)||r.filter(e=>e._type===t.name).forEach(t=>{if(_.xv.isText(i)&&Array.isArray(i.marks)&&i.marks.includes(t._key)){let n=[...(i.marks||[]).filter(e=>e!==t._key)];_.YR.setNodes(e,{marks:n},{at:a,voids:!1,split:!1})}}))})}}),_.ML.normalize(e),e.onChange()}},getSelection:()=>{let t=null;if(e.selection){let n=eO.get(e.selection);if(n)return n;t=e$(eE(e.children,i.block.name,eS.get(e)),e.selection,i),eO.set(e.selection,t)}return t},getValue:()=>eE(e.children,i.block.name,eS.get(e)),isCollapsedSelection:()=>!!e.selection&&_.e6.isCollapsed(e.selection),isExpandedSelection:()=>!!e.selection&&_.e6.isExpanded(e.selection)}),e},[u,g]=l?[]:function(e){let t,n,r,{patchFunctions:i,change$:a,schemaTypes:l,syncValue:s,incomingPatches$:o}=e,c=function(e,n){let r=!1;e7("\n\nNEW PATCH ============================================================="),e7(JSON.stringify(n,null,2));try{switch(n.type){case"insert":r=function(e,t){if(1===t.path.length){let{items:n,position:r}=t,i=eM(n,{schemaTypes:l},eC.get(e)),a=tt(t.path),s=e.children.findIndex((e,n)=>a?e._key===a:n===t.path[0]),o="after"===r?s+1:s;return e7("Inserting blocks at path [".concat(o,"]")),tn(e,"before"),_.YR.insertNodes(e,i,{at:[o]}),tn(e,"after"),!0}let{items:c,position:h}=t,f=tt(t.path),p=e.children.findIndex((e,n)=>f?e._key===f:n===t.path[0]),d=e.children&&p>-1?e.children[p]:void 0,u=e.isTextBlock(d)?d.children.findIndex((e,n)=>te(t.path[2])?e._key===t.path[2]._key:n===t.path[2]):0,g=d&&eM([ef(ef({},d),{},{children:c})],{schemaTypes:l},eC.get(e)),y=[p,"after"===h?u+1:u];return e7("Inserting children at path ".concat(y)),tn(e,"before"),g&&_.W_.isElement(g[0])&&_.YR.insertNodes(e,g[0].children,{at:y}),tn(e,"after"),!0}(e,n);break;case"unset":r=function(e,t,n){var r;if(0===t.path.length)return e7("Removing everything"),tn(e,"before"),_.YR.deselect(e),e.children.forEach((t,n)=>{_.YR.removeNodes(e,{at:[n]})}),tn(e,"after"),!0;if(1===t.path.length){let i=tt(t.path),a=e.children.findIndex((e,n)=>i?e._key===i:n===t.path[0]);if(e7("Removing block at path [".concat(a,"]")),tn(e,"before"),e.selection&&e.selection.focus.path[0]===a&&e.children[a-1]){let l={path:[Math.max(e.selection.focus.path[0]-1,0)],offset:0};_.YR.select(e,{focus:l,anchor:l}),_.YR.move(e,{unit:"line"})}return _.YR.removeNodes(e,{at:[a]}),tn(e,"after"),!0}let s=e.children.findIndex((e,n)=>te(t.path[0])?e._key===t.path[0]._key:n===t.path[0]),o=s>-1?e.children[s]:void 0;if(e.isTextBlock(o)&&"children"===t.path[1]&&3===t.path.length){let c=o.children.findIndex((e,n)=>te(t.path[2])?e._key===t.path[2]._key:n===t.path[2]),h=[s,c],f=e.selection&&ef({},e.selection),p=M()(null==(r=e.selection)?void 0:r.focus.path,h);if(e7("Removing child at path ".concat(JSON.stringify(h))),tn(e,"before"),f&&p&&e.isTextBlock(o)){let d=c>=f.focus.path[1];if(d){let u=o.children[c],g=(null==n?void 0:n.type)==="set"&&"text"===n.path[3]&&"string"==typeof n.value&&e.isTextSpan(u)&&M()(n.value.slice(-u.text.length),o.children[c].text);if(g){let y=o.children[Math.max(c-1,0)];return e7("Adjusting selection for merging of nodes"),f.focus=ef({},f.focus),f.focus.path=[h[0],Math.max(h[1]-1,0)],f.focus.offset=e.isTextSpan(y)?y.text.length-u.text.length+f.focus.offset:0,f.anchor=f.focus,_.YR.select(e,f),_.YR.removeNodes(e,{at:[s,c]}),tn(e,"after"),!0}}}return _.YR.removeNodes(e,{at:[s,c]}),tn(e,"after"),!0}if(!e.isTextBlock(o)){let m=[t].reduce(e4,[o])[0];return _.YR.setNodes(e,m,{at:[s]}),!0}return!1}(e,n,t);break;case"set":r=function(e,t){let n=e.children.findIndex((e,n)=>te(t.path[0])?e._key===t.path[0]._key:n===t.path[0]);e7("blockIndex",n);let r=n>-1?e.children[n]:void 0,i=e.isTextBlock(r)?r.children.findIndex((e,n)=>te(t.path[2])?e._key===t.path[2]._key:n===t.path[2]):0,a=t.value,l=i>-1?[n,i]:[n];"string"==typeof t.path[3]&&((a={})[t.path[3]]=t.value);let s=e.isTextBlock(r);if(s){if(e7("Setting nodes at ".concat(JSON.stringify(t.path)," - ").concat(JSON.stringify(l))),e7("Value to set",JSON.stringify(a,null,2)),tn(e,"before"),1===l.length){e7("Setting block property");let{children:o}=a,c=ec(a,ei),h=r||{children:void 0},{children:f}=h,p=ec(h,ea);e.apply({type:"set_node",path:l,properties:ef({},p),newProperties:c}),r&&_.W_.isElement(r)&&r.children.forEach((t,n)=>{e.apply({type:"remove_node",path:l.concat(n),node:t})}),Array.isArray(o)&&o.forEach((t,n)=>{e.apply({type:"insert_node",path:l.concat(n),node:t})})}else if(_.xv.isText(a)){e7("Setting text property");let d=e.selection&&ef({},e.selection);e.apply({type:"remove_text",path:l,offset:0,text:r.children[i].text}),e.apply({type:"insert_text",path:l,offset:0,text:a.text});let u=d&&M()(d.focus.path,l);u&&(e7("On same path, restoring previous selection"),_.YR.select(e,d))}else e7("Setting non-text property"),e.apply({type:"set_node",path:l,properties:{},newProperties:a});return tn(e,"after"),!0}if(r&&"value"in r){var g;let y=(g=[r.value],[t].reduce(e4,g))[0];return _.YR.setNodes(e,ef(ef({},r),{},{value:y}),{at:[n]}),!0}return!1}(e,n);break;case"diffMatchPatch":r=function(e,t){let n=tt([t.path[0]]),r=e.children.findIndex((e,r)=>n?e._key===n:r===t.path[0]),i=e.children[r],a=e8.patch_fromText(t.value)[0];if(a&&e.isTextBlock(i)){let l;let s=tt([t.path[2]]),o=i.children.findIndex((e,n)=>s?e._key===s:n===t.path[0]),c=[r,o],h=a.length2-a.length1,f={path:c,offset:h>=0?(a.start1||0)+a.diffs[0][1].length:(a.start2||0)+a.length2-h};return e7("DiffMatchPatch (".concat(h<0?"remove":"insert",") at ").concat(JSON.stringify(c),"}: "),JSON.stringify(f,null,2),JSON.stringify(a,null,2)),tn(e,"before"),l=a.diffs[1]?a.diffs[1][1]:a.diffs[0][1],e7("Text: '".concat(l,"'")),h>=0?e.apply({type:"insert_text",path:f.path,offset:f.offset,text:l}):e.apply({type:"remove_text",path:f.path,offset:f.offset-l.length,text:l}),tn(e,"after"),!0}return!1}(e,n);break;default:e7("Unhandled patch",n.type)}}catch(i){console.error(i)}return t=n,r},h=()=>{r&&(ty("Unsubscribing to patches"),r.unsubscribe())};return[function(e){eG.set(e,!0),n=[...e.children];let t=x()(()=>s(),100,{trailing:!0,leading:!1});o&&(ty("Subscribing to patches"),r=o.subscribe(n=>{let{patches:r,snapshot:i}=n;ty("Incoming patches",r);let a=r.filter(e=>"local"!==e.origin);0!==a.length&&_.ML.withoutNormalizing(e,()=>{a.forEach(t=>{ty("Handling remote patch ".concat(JSON.stringify(t))),eX(e,()=>{tg(e,()=>{!function(e,t){let n=eZ.get(e);eZ.set(e,!0),t(),eZ.set(e,!n)}(e,()=>{try{c(e,t,r,i)}catch(n){ty("Got error trying to create operations from patch"),console.error(n)}})})})})}),r.length>0&&t()}));let{apply:h}=e;return e.apply=t=>{if(e.readOnly)return h(t),e;let r=[];n=e.children;let s=eT(n,l);h(t);let o=eT(e.children,l);if(!eG.get(e))return ty("Editor is not producing patch for operation ".concat(t.type),t),e;switch(s&&"set_selection"!==t.type&&(r.push(ed([],[])),n.forEach((e,t)=>{r.push(ey(eE([e],l.block.name),"before",[t]))})),t.type){case"insert_text":r=[...r,...i.insertTextPatch(e,t,n)];break;case"remove_text":r=[...r,...i.removeTextPatch(e,t,n)];break;case"remove_node":r=[...r,...i.removeNodePatch(e,t,n)];break;case"split_node":r=[...r,...i.splitNodePatch(e,t,n)];break;case"insert_node":r=[...r,...i.insertNodePatch(e,t,n)];break;case"set_node":r=[...r,...i.setNodePatch(e,t,n)];break;case"merge_node":r=[...r,...i.mergeNodePatch(e,t,n)];break;case"move_node":r=[...r,...i.moveNodePatch(e,t,n)]}return o&&["remove_text","remove_node"].includes(t.type)&&(r=[...r,ek([])],a.next({type:"unset",previousValue:eE(n,l.block.name,eS.get(e))})),r.length>0&&r.forEach(e=>{a.next({type:"patch",patch:ef(ef({},e),{},{origin:"local"})})}),e},e},h]}({patchFunctions:h,change$:s,schemaTypes:i,syncValue:o,incomingPatches$:c}),y=function(e){return e.pteToggleListItem=t=>{let n=e.pteHasListStyle(t);n?(tv("Remove list item '".concat(t,"'")),e.pteUnsetListItem(t)):(tv("Add list item '".concat(t,"'")),e.pteSetListItem(t))},e.pteUnsetListItem=t=>{if(!e.selection)return;let n=[..._.ML.nodes(e,{at:e.selection,match:e=>_.W_.isElement(e)&&e._type===i.block.name})];n.forEach(n=>{let[r,i]=n;if(e.isListBlock(r)){let{listItem:a,level:l}=r,s=ec(r,el),o=ef(ef({},s),{},{listItem:void 0,level:void 0});tv("Unsetting list '".concat(t,"'")),_.YR.setNodes(e,o,{at:i})}})},e.pteSetListItem=t=>{if(!e.selection)return;let n=[..._.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];n.forEach(n=>{let[r,a]=n;tv("Setting list '".concat(t,"'")),_.YR.setNodes(e,ef(ef({},r),{},{level:1,listItem:t||i.lists[0]&&i.lists[0].value}),{at:a})})},e.pteEndList=()=>{if(!e.selection)return!1;let t=[..._.ML.nodes(e,{at:e.selection,match:t=>_.W_.isElement(t)&&e.isListBlock(t)&&1===t.children.length&&_.xv.isText(t.children[0])&&""===t.children[0].text})];return 0!==t.length&&(t.forEach(t=>{let[n,r]=t;_.W_.isElement(n)&&(tv("Unset list"),_.YR.setNodes(e,ef(ef({},n),{},{level:void 0,listItem:void 0}),{at:r}))}),!0)},e.pteIncrementBlockLevels=t=>{if(!e.selection)return!1;let n=[..._.ML.nodes(e,{at:e.selection,match:t=>!!e.isListBlock(t)})];return 0!==n.length&&(n.forEach(n=>{let[r,i]=n;if(e.isListBlock(r)){let a=r.level||1;t?tv("Decrementing list level",Math.min(10,Math.max(1,--a))):tv("Incrementing list level",Math.min(10,Math.max(1,++a))),_.YR.setNodes(e,{level:Math.min(10,Math.max(1,a))},{at:i})}}),!0)},e.pteHasListStyle=t=>{if(!e.selection)return!1;let n=[..._.ML.nodes(e,{at:e.selection,match:n=>e.isListBlock(n)&&n.listItem===t})];return n.length>0},e},[m,k]=l?[]:function(e){let t=()=>void 0,n=[];if(e){tr("Subscribing to patches");let r=e.subscribe(e=>{let{patches:t}=e;t.forEach(e=>{"local"!==e.origin&&n.push({patch:e,time:new Date})})});t=()=>{tr("Unsubscribing to patches"),r.unsubscribe()}}return[e=>{e.history={undos:[],redos:[]};let{apply:t}=e;return e.apply=n=>{if(e.readOnly){t(n);return}let{operations:r,history:i}=e,{undos:a}=i,l=a[a.length-1],s=l&&l.operations&&l.operations[l.operations.length-1],o=td(n,s),c=to(e),h=ts(e);if(null==c&&(c=tp(n)),c){if(null==h&&(h=null!=l&&(0!==r.length||tf(n,s)||o)),l&&h)o&&l.operations.pop(),l.operations.push(n);else{let f={operations:[...null===e.selection?[]:[{type:"set_selection",properties:ef({},e.selection),newProperties:ef({},e.selection)}],n],timestamp:new Date};a.push(f),tr("Created new undo step",l)}for(;a.length>300;)a.shift();tu(n)&&(i.redos=[])}t(n)},e.undo=()=>{if(e.readOnly)return;let{undos:t}=e.history;if(t.length>0){let r=t[t.length-1];if(tr("Undoing",r),r.operations.length>0){let i=[...n.filter(e=>e.time>=r.timestamp)],a=r.operations;i.forEach(t=>{a=P()(a.map(n=>tc(e,t.patch,n)))}),tg(e,()=>{_.ML.withoutNormalizing(e,()=>{a.map(_.OX.inverse).reverse().forEach(t=>{try{e.apply(t)}catch(n){tr("Could not perform undo step",n),e.history.redos.push(r),e.history.undos.pop()}})})})}e.history.redos.push(r),e.history.undos.pop(),e.onChange()}},e.redo=()=>{if(e.readOnly)return;let{redos:t}=e.history;if(t.length>0){let r=t[t.length-1];if(tr("Redoing",r),r.operations.length>0){let i=n.filter(e=>e.time>r.timestamp),a=r.operations;i.forEach(t=>{a=P()(a.map(n=>tc(e,t.patch,n)))}),tg(e,()=>{_.ML.withoutNormalizing(e,()=>{a.forEach(t=>{try{e.apply(t)}catch(n){tr("Could not perform redo step",n),e.history.undos.push(r),e.history.redos.pop()}})})})}e.history.undos.push(r),e.history.redos.pop(),e.onChange()}},e},t]}(c),v=function(e){let{apply:t,normalizeNode:n}=e,r=i.decorators.map(e=>e.value);return e.normalizeNode=t=>{n(t),e.operations.some(e=>["insert_node","insert_text","merge_node","remove_node","remove_text","set_node"].includes(e.type))&&function(e){let{selection:t}=e;if(t)for(let[n,r]of Array.from(_.ML.nodes(e,{at:_.ML.range(e,[t.anchor.path[0]],[t.focus.path[0]])})).reverse()){let[i]=r.length>1?_.ML.node(e,_.y$.parent(r)):[void 0],a=[r[0],r[1]+1];if(_.ML.isBlock(e,i)){let l=i.children[a[1]];_.xv.isText(n)&&_.xv.isText(l)&&M()(l.marks,n.marks)&&(t_("Merging spans"),_.YR.mergeNodes(e,{at:a,voids:!0}),e.onChange())}}}(e);let[r,a]=t,l=_.xv.isText(r)&&r._type===i.span.name,s=e.isTextBlock(r);if(l||s){for(let o of(s||Array.isArray(r.marks)||(t_("Adding .marks to span node"),_.YR.setNodes(e,{marks:[]},{at:a}),e.onChange()),e.operations)){if("merge_node"===o.type&&1===o.path.length&&"markDefs"in o.properties&&o.properties._type===i.block.name&&Array.isArray(o.properties.markDefs)&&o.properties.markDefs.length>0&&o.path[0]-1>=0){let[c,h]=_.ML.node(e,[o.path[0]-1]);if(t_("Copying markDefs over to merged block",o),e.isTextBlock(c)){let f=Array.isArray(c.markDefs)&&c.markDefs||[],p=S()([...f,...o.properties.markDefs]),d=M()(p,c.markDefs);d||(_.YR.setNodes(e,{markDefs:p},{at:h,voids:!1}),e.onChange())}}if("split_node"===o.type&&1===o.path.length&&_.W_.isElementProps(o.properties)&&o.properties._type===i.block.name&&"markDefs"in o.properties&&Array.isArray(o.properties.markDefs)&&o.properties.markDefs.length>0&&o.path[0]+1<e.children.length){let[u,g]=_.ML.node(e,[o.path[0]+1]);if(t_("Copying markDefs over to split block",o),e.isTextBlock(u)){let y=Array.isArray(u.markDefs)&&u.markDefs||[];_.YR.setNodes(e,{markDefs:S()([...y,...o.properties.markDefs])},{at:g,voids:!1}),e.onChange()}}if("split_node"===o.type&&2===o.path.length&&o.properties._type===i.span.name&&"marks"in o.properties&&Array.isArray(o.properties.marks)&&o.properties.marks.length>0&&o.path[0]+1<e.children.length){let[m,k]=_.ML.node(e,[o.path[0]+1,0]);_.xv.isText(m)&&""===m.text&&Array.isArray(m.marks)&&m.marks.length>0&&(_.YR.setNodes(e,{marks:[]},{at:k,voids:!1}),e.onChange())}if("split_node"===o.type&&1===o.path.length&&o.properties._type===i.block.name&&"markDefs"in o.properties&&Array.isArray(o.properties.markDefs)&&o.properties.markDefs.length>0){let[v,b]=_.ML.node(e,[o.path[0]]);e.isTextBlock(v)&&1===v.children.length&&v.markDefs&&v.markDefs.length>0&&_.xv.isText(v.children[0])&&""===v.children[0].text&&(!v.children[0].marks||0===v.children[0].marks.length)&&(_.YR.setNodes(e,{markDefs:[]},{at:b}),e.onChange())}}l&&Array.isArray(r.marks)&&r.marks.length>0&&""===r.text&&(_.YR.setNodes(e,{marks:[]},{at:a,voids:!1}),e.onChange())}s&&e.operations.some(e=>["split_node","remove_node","remove_text","merge_node"].includes(e.type))&&function(e){let{selection:t}=e;if(t){let n=_.ML.nodes(e,{at:t,match:e=>e._type===i.block.name});for(let[r,a]of n)if(e.isTextBlock(r)){let l=(r.markDefs||[]).filter(e=>r.children.find(t=>_.xv.isText(t)&&Array.isArray(t.marks)&&t.marks.includes(e._key)));M()(l,r.markDefs)||(t_("Removing markDef not in use"),_.YR.setNodes(e,{markDefs:l},{at:a}),e.onChange())}}}(e)},e.apply=n=>{var a,l;if("insert_text"===n.type){let{selection:s}=e;if(s&&_.e6.isCollapsed(s)&&(null==(l=null==(a=_.ML.marks(e))?void 0:a.marks)?void 0:l.some(e=>!r.includes(e)))){let[o]=Array.from(_.ML.nodes(e,{mode:"lowest",at:s.focus,match:e=>e._type===i.span.name,voids:!1}))[0]||[void 0];if(_.xv.isText(o)&&o.text.length===s.focus.offset&&Array.isArray(o.marks)&&o.marks.length>0){t(n),_.YR.splitNodes(e,{match:_.xv.isText,at:ef(ef({},s.focus),{},{offset:s.focus.offset})});let c=(ef({},_.ML.marks(e)||{}).marks||[]).filter(e=>r.includes(e));_.YR.setNodes(e,{marks:c},{at:_.y$.next(s.focus.path)});return}}}t(n)},e.addMark=t=>{if(e.selection){if(_.e6.isExpanded(e.selection)){_.YR.setNodes(e,{},{match:_.xv.isText,split:!0});let n=[..._.ML.nodes(e,{at:e.selection,match:_.xv.isText})],r=P()(n.map(e=>e[0]).map(e=>e.marks)).includes(t);if(r){e.removeMark(t);return}_.ML.withoutNormalizing(e,()=>{n.forEach(n=>{let[r,i]=n,a=[...(Array.isArray(r.marks)?r.marks:[]).filter(e=>e!==t),t];_.YR.setNodes(e,{marks:a},{at:i,match:_.xv.isText,split:!0,hanging:!0})})}),_.ML.normalize(e)}else{let i=ef({},_.ML.marks(e)||{}).marks||[],a=ef(ef({},_.ML.marks(e)||{}),{},{marks:[...i,t]});e.marks=a}e.onChange()}},e.removeMark=t=>{let{selection:n}=e;if(n){if(_.e6.isExpanded(n))_.ML.withoutNormalizing(e,()=>{if(_.YR.setNodes(e,{},{match:_.xv.isText,split:!0}),e.selection){let n=[..._.ML.nodes(e,{at:e.selection,match:_.xv.isText})];n.forEach(n=>{let[r,i]=n,a=e.children[i[0]];_.W_.isElement(a)&&a.children.includes(r)&&_.YR.setNodes(e,{marks:(Array.isArray(r.marks)?r.marks:[]).filter(e=>e!==t)},{at:i})})}}),_.ML.normalize(e);else{let r=ef({},_.ML.marks(e)||{}).marks||[],i=ef(ef({},_.ML.marks(e)||{}),{},{marks:r.filter(e=>e!==t)});e.marks=i}e.onChange()}},e.pteIsMarkActive=t=>{if(!e.selection||e.selection.focus.path.length<2)return!1;let n=ef({},_.ML.marks(e)||{}).marks||[];return _.e6.isExpanded(e.selection)&&Array.from(_.ML.nodes(e,{match:_.xv.isText,at:e.selection})).forEach(e=>{let[t]=e;n=S()([...n,...t.marks||[]])}),n.includes(t)},e.pteToggleMark=t=>{let n=e.pteIsMarkActive(t);n?(t_("Remove mark '".concat(t,"'")),_.ML.removeMark(e,t)):(t_("Add mark '".concat(t,"'")),_.ML.addMark(e,t,!0)),e.onChange()},e},b=function(e,t){let n=e.styles[0].value;return function(r){let{normalizeNode:i}=r;return r.normalizeNode=e=>{i(e);let[,t]=e;for(let a of r.operations)if("split_node"===a.type&&1===a.path.length&&r.isTextBlock(a.properties)&&a.properties.style!==n&&a.path[0]===t[0]&&!_.y$.equals(t,a.path)){let[l]=_.ML.node(r,[a.path[0]+1,0]);if(_.xv.isText(l)&&""===l.text){tk("Normalizing split node to ".concat(n," style"),a),_.YR.setNodes(r,{style:n},{at:[a.path[0]+1],voids:!1});break}}},r.pteHasBlockStyle=e=>{if(!r.selection)return!1;let t=[..._.ML.nodes(r,{at:r.selection,match:t=>r.isTextBlock(t)&&t.style===e})];return t.length>0},r.pteToggleBlockStyle=i=>{if(!r.selection)return;let a=[..._.ML.nodes(r,{at:r.selection,match:t=>_.W_.isElement(t)&&t._type===e.block.name})];a.forEach(e=>{let[t,a]=e;r.isTextBlock(t)&&t.style===i?(tk("Unsetting block style '".concat(i,"'")),_.YR.setNodes(r,ef(ef({},t),{},{style:n}),{at:a})):(i?tk("Setting style '".concat(i,"'")):tk("Setting default style",n),_.YR.setNodes(r,ef(ef({},t),{},{style:i||n}),{at:a}))}),t.next({type:"selection",selection:e$(eE(r.children,e.block.name),r.selection,e)}),r.onChange()},r}}(i,s),w=function(e){let{schemaTypes:t,keyGenerator:n}=e;return function(e){e.createPlaceholderBlock=()=>({_type:t.block.name,_key:n(),style:t.styles[0].value||"normal",markDefs:[],children:[{_type:"span",_key:n(),text:"",marks:[]}]});let{onChange:r}=e;return e.onChange=()=>{r(),0===e.children.length&&eX(e,()=>{tg(e,()=>{tm("Inserting placeholder block"),_.YR.deselect(e),_.YR.insertNodes(e,e.createPlaceholderBlock(),{at:[0]}),_.YR.select(e,{focus:{path:[0,0],offset:0},anchor:{path:[0,0],offset:0}}),e.onChange()})})},e}}({keyGenerator:a,schemaTypes:i}),E=function(e){let{schemaTypes:t,keyGenerator:n}=e;return function(e){return e.pteExpandToWord=()=>{let{selection:t}=e;if(t&&!_.e6.isExpanded(t)){let[n]=_.ML.node(e,t.focus,{depth:2});if(!n||!_.xv.isText(n)||0===n.text.length){tw("pteExpandToWord: Can't expand to word here");return}let{focus:r}=t,i=r.offset,a=n.text.slice(0,i),l=n.text.slice(i,-1),s=e=>e.match(/\s/g),o=a.split("").reverse().findIndex(e=>s(e)),c=o>-1?a.length-o:0,h=l.split("").findIndex(e=>s(e)),f=a.length+(h>-1?h:l.length+1);if(!(c===f||isNaN(c)||isNaN(f))){tw("pteExpandToWord: Expanding to focused word"),_.YR.setSelection(e,{anchor:ef(ef({},t.anchor),{},{offset:c}),focus:ef(ef({},t.focus),{},{offset:f})});return}tw("pteExpandToWord: Can't expand to word here")}},e}}({keyGenerator:a,schemaTypes:i}),T=function(e){let t=()=>{let t=null;if(e.selection){let n=eO.get(e.selection);n?t=n:(t=e$(eE(e.children,i.block.name,eS.get(e)),e.selection,i),eO.set(e.selection,t))}tb("Emitting selection ".concat(JSON.stringify(t||null))),t?s.next({type:"selection",selection:t}):s.next({type:"selection",selection:null})},{onChange:n}=e;return e.onChange=()=>{let r=e.operations.length>0;n(),r&&t()},e};return(n.destroy=()=>{let e=tA.get(n);if(!e)throw Error("Could not find pristine versions of editor functions");n.onChange=e.onChange,n.apply=e.apply,n.normalizeNode=e.normalizeNode,g&&g(),k&&k()},l)?p(f(v(b(E(w(y(T(d(n))))))))):m&&u?p(f(v(b(y(w(E(function(e){let{apply:t}=e;return e.apply=n=>{let r=e.maxBlocks||-1;r>0&&e.children.length>=r&&("insert_node"===n.type||"split_node"===n.type)&&1===n.path.length||t(n)},e}(m(u(T(d(n)))))))))))):n},tI=()=>(0,v.E2)(12),tL=eb("component:PortableTextEditor");class tC extends h.Component{constructor(e){var t,n,r,i;if(super(e),this.change$=new f.xQ,this.pendingPatches=[],this.returnedPatches=[],this.setEditable=e=>{this.editable=ef(ef({},this.editable),e),this.change$.next({type:"value",value:this.props.value||void 0}),this.change$.next({type:"ready"})},this.syncValue=e=>{let t=this.props.value,n=()=>{tL("Updating slate instance"),this.slateInstance.onChange(),this.change$.next({type:"value",value:t}),e&&e()};if(this.hasPendingLocalPatches.current&&!this.readOnly){tL("Not syncing value (has pending local patches)"),tS(()=>this.syncValue(),n);return}if(eT(this.slateInstance.children,this.schemaTypes)&&this.props.value){let r=this.slateInstance.selection;_.YR.deselect(this.slateInstance),this.slateInstance.children=eM(t,{schemaTypes:this.schemaTypes},eC.get(this.slateInstance)),r&&_.YR.select(this.slateInstance,r),tL("Setting props.value directly to empty editor"),n();return}let i=!(t||[]).some((e,t)=>{let n=eM([e],{schemaTypes:this.schemaTypes},eC.get(this.slateInstance))[0];return!M()(n,this.slateInstance.children[t])});if(i){tL("Not syncing value (value is equal)");return}tL("Validating");let a=ev(t,this.schemaTypes,this.keyGenerator);if(t&&!a.valid&&(this.change$.next({type:"invalidValue",resolution:a.resolution,value:t}),this.setState({invalidValueResolution:a.resolution})),tL("Replacing changed nodes"),t&&t.length>0){let l=this.slateInstance.selection;_.YR.deselect(this.slateInstance);let s=eM(t,{schemaTypes:this.schemaTypes},eC.get(this.slateInstance));this.slateInstance.children=s,l&&_.YR.select(this.slateInstance,l)}n()},this.flush=()=>{let{onChange:e}=this.props,t=[...this.pendingPatches];t.length>0&&(tL("Flushing",t),t.forEach(e=>{this.returnedPatches.push(e)}),e({type:"mutation",patches:t}),this.pendingPatches=[])},this.flushDebounced=x()(this.flush,1e3,{leading:!1,trailing:!0}),!e.schemaType)throw Error('PortableTextEditor: missing "type" property');if(this.hasPendingLocalPatches=h.createRef(),this.hasPendingLocalPatches.current=!1,this.state={invalidValueResolution:null,selection:null,initialValue:[]},this.type=e.schemaType.hasOwnProperty("jsonType")?e.schemaType:(t=e.schemaType,D.Z.compile({name:"blockTypeSchema",types:[t]}).get(t.name)),this.change$.next({type:"loading",isLoading:!0}),this.schemaTypes=function(e){var t,n,r;if(!e)throw Error("Parameter 'portabletextType' missing (required)");let i=null==(t=e.of)?void 0:t.find(function e(t){return t.type?e(t.type):"block"===t.name?t:null});if(!i)throw Error("Block type is not defined in this schema (required)");let a=null==(n=i.fields)?void 0:n.find(e=>"children"===e.name);if(!a)throw Error("Children field for block type found in schema (required)");let l=a.type.of;if(!l)throw Error("Valid types for block children not found in schema (required)");let s=l.find(e=>"span"===e.name);if(!s)throw Error("Span type not found in schema (required)");let o=l.filter(e=>"span"!==e.name)||[],c=(null==(r=e.of)?void 0:r.filter(e=>e.name!==i.name))||[];return{styles:function(e){var t,n,r;let i=null==(t=e.fields)?void 0:t.find(e=>"style"===e.name);if(!i)throw Error("A field with name 'style' is not defined in the block type (required).");let a=(null==(n=i.type.options)?void 0:n.list)&&(null==(r=i.type.options.list)?void 0:r.filter(e=>e.value));if(!a||0===a.length)throw Error("The style fields need at least one style defined. I.e: {title: 'Normal', value: 'normal'}.");return a}(i),decorators:s.decorators,lists:function(e){var t,n;let r=null==(t=e.fields)?void 0:t.find(e=>"list"===e.name);if(!r)throw Error("A field with name 'list' is not defined in the block type (required).");let i=(null==(n=r.type.options)?void 0:n.list)&&r.type.options.list.filter(e=>e.value);if(!i)throw Error("The list field need at least to be an empty array");return i}(i),block:i,span:s,portableText:e,inlineObjects:o,blockObjects:c,annotations:s.annotations}}(this.type),this.keyGenerator=e.keyGenerator||tI,e.incomingPatches$&&(this.incomingPatches$=e.incomingPatches$.pipe((0,g.b)(e=>{let{patches:t}=e;t.some(e=>"local"===e.origin)&&(this.hasPendingLocalPatches.current=!1)})).pipe((i=()=>!this.hasPendingLocalPatches.current,e=>(0,p.P)(()=>{let t=[];return e.pipe((0,g.b)(e=>t.push(e)),(0,k.w)(()=>i(t)?(0,d.of)(t):u.E),(0,g.b)(()=>t=[]))})),(0,y.b)(e=>e),(0,m.B)())),this.changeSubscription=this.change$.subscribe(e=>{let{onChange:t}=this.props;switch(e.type){case"patch":this.pendingPatches.push(e.patch),this.props.incomingPatches$&&(this.hasPendingLocalPatches.current=!0),this.flushDebounced(),t(e);break;case"selection":t(e),this.setState({selection:e.selection});break;default:t(e)}}),this.maxBlocks=void 0===e.maxBlocks?void 0:parseInt(e.maxBlocks.toString(),10)||void 0,this.readOnly=Boolean(e.readOnly)||!1,e.value){let a=ev(e.value,this.schemaTypes,this.keyGenerator);e.value&&!a.valid&&(this.change$.next({type:"loading",isLoading:!1}),this.change$.next({type:"invalidValue",resolution:a.resolution,value:e.value}),this.state=ef(ef({},this.state),{},{invalidValueResolution:a.resolution}))}this.slateInstance=tP((0,N.BU)((0,_.Jh)()),{portableTextEditor:this}),this.state=ef(ef({},this.state),{},{initialValue:eM((n=e.value,r=[this.slateInstance.createPlaceholderBlock()],n&&Array.isArray(n)&&n.length>0?n:r),{schemaTypes:this.schemaTypes},eC.get(this.slateInstance))}),eS.set(this.slateInstance,{}),eC.set(this.slateInstance,{})}componentWillUnmount(){this.flush(),this.changeSubscription.unsubscribe(),this.slateInstance.destroy()}componentDidUpdate(e){this.props.readOnly!==e.readOnly&&(this.readOnly=Boolean(this.props.readOnly),this.slateInstance=tP(this.slateInstance,{portableTextEditor:this})),this.props.maxBlocks!==e.maxBlocks&&(this.maxBlocks=void 0===this.props.maxBlocks?void 0:parseInt(this.props.maxBlocks.toString(),10)||void 0,this.slateInstance.maxBlocks=this.maxBlocks),this.props.value===e.value||e.value&&!this.readOnly&&this.props.incomingPatches$||this.syncValue()}render(){return this.state.invalidValueResolution?this.state.invalidValueResolution.description:(0,c.jsx)(eR.Provider,{value:this,children:(0,c.jsx)(eV.Provider,{value:this.props.value,children:(0,c.jsx)(eW.Provider,{value:Boolean(this.props.readOnly),children:(0,c.jsx)(ej.Provider,{value:this.state.selection,children:(0,c.jsx)(N.mH,{onChange:tO,editor:this.slateInstance,value:this.state.initialValue,children:this.props.children})})})})})}}tC.activeAnnotations=e=>e&&e.editable?e.editable.activeAnnotations():[],tC.addAnnotation=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.addAnnotation(t,n)},tC.blur=e=>{var t;tL("Host blurred"),null==(t=e.editable)||t.blur()},tC.delete=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.delete(t,n)},tC.findDOMNode=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.findDOMNode(t)},tC.findByPath=(e,t)=>{var n;return(null==(n=e.editable)?void 0:n.findByPath(t))||[]},tC.focus=e=>{var t;tL("Host requesting focus"),null==(t=e.editable)||t.focus()},tC.focusBlock=e=>{var t;return null==(t=e.editable)?void 0:t.focusBlock()},tC.focusChild=e=>{var t;return null==(t=e.editable)?void 0:t.focusChild()},tC.getSelection=e=>e.editable?e.editable.getSelection():null,tC.getValue=e=>{var t;return null==(t=e.editable)?void 0:t.getValue()},tC.hasBlockStyle=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.hasBlockStyle(t)},tC.hasListStyle=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.hasListStyle(t)},tC.isCollapsedSelection=e=>{var t;return null==(t=e.editable)?void 0:t.isCollapsedSelection()},tC.isExpandedSelection=e=>{var t;return null==(t=e.editable)?void 0:t.isExpandedSelection()},tC.isMarkActive=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.isMarkActive(t)},tC.insertChild=(e,t,n)=>{var r;return tL("Host inserting child"),null==(r=e.editable)?void 0:r.insertChild(t,n)},tC.insertBlock=(e,t,n)=>{var r;return null==(r=e.editable)?void 0:r.insertBlock(t,n)},tC.isVoid=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.isVoid(t)},tC.isObjectPath=(e,t)=>{if(!t||!Array.isArray(t))return!1;let n=t.length>3&&"children"===t[1],r=t.length>1&&"children"!==t[1];return r||n},tC.marks=e=>{var t;return null==(t=e.editable)?void 0:t.marks()},tC.select=(e,t)=>{var n;tL("Host setting selection",t),null==(n=e.editable)||n.select(t)},tC.removeAnnotation=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.removeAnnotation(t)},tC.toggleBlockStyle=(e,t)=>{var n;return tL("Host is toggling block style"),null==(n=e.editable)?void 0:n.toggleBlockStyle(t)},tC.toggleList=(e,t)=>{var n;return null==(n=e.editable)?void 0:n.toggleList(t)},tC.toggleMark=(e,t)=>{var n;tL("Host toggling mark",t),null==(n=e.editable)||n.toggleMark(t)};let tS=T()((e,t)=>e(t),100),tO=()=>void 0;function tR(e,t){if(!e||!t)return null;let n=[],r=e.offset||0,i="object"==typeof e.path[0]&&"_key"in e.path[0]&&e.path[0]._key,a="object"==typeof e.path[2]&&"_key"in e.path[2]&&e.path[2]._key,l=t.find(e=>e._key===i);if(!l)return null;if(n.push({_key:l._key}),l&&"children"===e.path[1]){if(!l.children||Array.isArray(l.children)&&0===l.children.length)return null;let s=Array.isArray(l.children)&&l.children.find(e=>e._key===a);if(!s)return null;n.push("children"),n.push({_key:s._key}),r=s.text&&s.text.length>=e.offset?e.offset:s.text&&s.text.length||0}return{path:n,offset:r}}function tB(e){let t=(0,h.useCallback)(()=>alert(JSON.stringify(e.annotation)),[e.annotation]);return(0,c.jsx)("span",{style:{color:"blue"},onClick:t,children:e.children})}let tj=eb("components:DraggableChild"),tY=e=>{let{children:t,element:n,readOnly:r}=e,i=(0,N._7)(),a=(0,h.useRef)(),l=(0,h.useMemo)(()=>_.ML.isVoid(i,n),[i,n]),s=(0,h.useCallback)(e=>{let t=eA.get(i);if(!t)return;tj("handle drag over"),e.preventDefault(),e.dataTransfer.dropEffect="move";let n=N.F3.findEventRange(i,e);n&&(eI.set(i,n),_.YR.select(i,n))},[i]),o=(0,h.useCallback)(e=>{if(tj("Drag start"),eN.set(i,!0),eA.set(i,n),l){e.dataTransfer.effectAllowed="move";let t=e.currentTarget;if(t instanceof HTMLElement){let r=t.cloneNode(!0);if(a.current=r,r.style.width="".concat(t.clientWidth,"px"),r.style.height="".concat(t.clientHeight,"px"),r.style.position="absolute",r.style.top="-99999px",r.style.left="-99999px",document.body){document.body.appendChild(r);let s=t.getBoundingClientRect(),o=e.clientX-s.left,c=e.clientY-s.top;r.style.width="".concat(s.width,"px"),r.style.height="".concat(s.height,"px"),e.dataTransfer.setDragImage(r,o,c)}}}},[i,n,l]);return r?t:(0,c.jsx)("span",{draggable:l,onDragStart:o,onDragOver:s,children:t})};eb("components:Leaf");let tW=e=>{let t=(0,N._7)(),n=(0,N.vt)(),{attributes:r,children:i,leaf:a,schemaTypes:l,keyGenerator:s,renderChild:o,readOnly:f}=e,p=h.useRef(null),d=i,u=n&&t.selection&&_.e6.isCollapsed(t.selection)||!1;if(_.xv.isText(a)&&a._type===l.span.name){let g=i.props.parent,y=g?[{_key:g._key},"children",{_key:a._key}]:[],m=l.decorators.map(e=>e.value),k=S()((Array.isArray(a.marks)?a.marks:[]).filter(e=>m.includes(e)));k.forEach(t=>{let r=l.decorators.find(e=>e.value===t);r&&e.renderDecorator&&(d=e.renderDecorator({children:d,editorElementRef:p,focused:u,path:y,selected:n,type:r,value:t}))});let v=Array.isArray(a.marks)?a.marks:[],b=v.map(e=>!m.includes(e)&&g&&g.markDefs&&g.markDefs.find(t=>t._key===e)).filter(Boolean);if(g&&b.length>0&&b.forEach(t=>{let r=l.annotations.find(e=>e.name===t._type);r&&(d=e.renderAnnotation?(0,c.jsx)("span",{ref:p,children:e.renderAnnotation({block:g,children:d,editorElementRef:p,focused:u,path:y,selected:n,type:r,value:t})}):(0,c.jsx)(tB,{annotation:t,children:(0,c.jsx)("span",{ref:p,children:d})}))}),g&&o){let x=g.children.find(e=>e._key===a._key);if(x){let w=(0,c.jsx)(c.Fragment,{children:d});d=o({children:w,value:x,schemaType:l.span,focused:u,selected:n,path:y,annotations:b,editorElementRef:p})}}}let M=a._key||s();return(0,c.jsx)("span",ef(ef({},r),{},{ref:p,children:(0,c.jsx)(tY,{element:a,readOnly:f,children:d})}),M)},tJ=e=>(0,c.jsx)("div",{children:(0,c.jsx)("pre",{children:JSON.stringify(e.value,null,2)})}),tV=ee.ZP.div(a||(a=eo(["\n  user-select: none;\n  border: ",";\n"])),e=>e.selected?"1px solid blue":"1px solid transparent");ee.ZP.span(l||(l=eo(["\n  background: #999;\n  border: ",";\n"])),e=>e.selected?"1px solid blue":"1px solid transparent");let tz=ee.ZP.div(s||(s=eo(["\n  &.pt-list-item {\n    width: fit-content;\n    position: relative;\n    display: block;\n\n    /* Important 'transform' in order to force refresh the ::before and ::after rules\n      in Webkit: https://stackoverflow.com/a/21947628/831480\n    */\n    transform: translateZ(0);\n    margin-left: ",";\n  }\n  &.pt-list-item > .pt-list-item-inner {\n    display: flex;\n    margin: 0;\n    padding: 0;\n    &:before {\n      justify-content: flex-start;\n      vertical-align: top;\n    }\n  }\n  &.pt-list-item-bullet > .pt-list-item-inner:before {\n      content: '","';\n      font-size: 0.4375rem; /* 7px */\n      line-height: 1.5rem; /* Same as body text */\n      /* Optical alignment */\n      position: relative;\n    }\n  }\n  &.pt-list-item-bullet > .pt-list-item-inner {\n    &:before {\n      min-width: 1.5rem; /* Make sure space between bullet and text never shrinks */\n    }\n  }\n  &.pt-list-item-number {\n    counter-increment: ",";\n    counter-reset: ",";\n  }\n  & + :not(.pt-list-item-number) {\n    counter-reset: listItemNumber;\n  }\n  &.pt-list-item-number > .pt-list-item-inner:before {\n    content: ",";\n    min-width: 1.5rem; /* Make sure space between number and text never shrinks */\n    /* Optical alignment */\n    position: relative;\n    top: 1px;\n  }\n"])),e=>(function(e){switch(Number(e)){case 1:return"1.5em";case 2:return"3em";case 3:return"4.5em";case 4:return"6em";case 5:return"7.5em";case 6:return"9em";case 7:return"10.5em";case 8:return"12em";case 9:return"13.5em";case 10:return"15em";default:return"0em"}})(e.listLevel),e=>{var t;return t=e.listLevel,"bullet"===e.listStyle?tU[(t-1)%3]:"*"},e=>(function(e){switch(e){case 1:return"listItemNumber";case 2:return"listItemAlpha";case 3:return"listItemRoman";case 4:return"listItemNumberNext";case 5:return"listItemLetterNext";case 6:return"listItemRomanNext";case 7:return"listItemNumberNextNext";case 8:return"listItemAlphaNextNext";case 9:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel),e=>(function(e){switch(e){case 1:return"listItemAlpha";case 2:return"listItemRoman";case 3:return"listItemNumberNext";case 4:return"listItemLetterNext";case 5:return"listItemRomanNext";case 6:return"listItemNumberNextNext";case 7:return"listItemAlphaNextNext";case 8:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel),e=>(function(e){switch(e){case 1:return"counter(listItemNumber) '. '";case 2:return"counter(listItemAlpha, lower-alpha) '. '";case 3:return"counter(listItemRoman, lower-roman) '. '";case 4:return"counter(listItemNumberNext) '. '";case 5:return"counter(listItemLetterNext, lower-alpha) '. '";case 6:return"counter(listItemRomanNext, lower-roman) '. '";case 7:return"counter(listItemNumberNextNext) '. '";case 8:return"counter(listItemAlphaNextNext, lower-alpha) '. '";case 9:return"counter(listItemRomanNextNext, lower-roman) '. '";default:return"counter(listItemNumberNextNextNext) '. '"}})(e.listLevel)),tF=ee.ZP.div(o||(o=eo([""]))),tU=["","",""],t$=eb("components:DraggableBlock"),tH=e=>{let{children:t,element:n,readOnly:r,blockRef:i}=e,a=(0,N._7)(),l=(0,h.useRef)(),[s,o]=(0,h.useState)(!1),f=(0,h.useMemo)(()=>_.ML.isVoid(a,n),[a,n]),p=(0,h.useMemo)(()=>_.ML.isInline(a,n),[a,n]),[d,u]=(0,h.useState)(null);(0,h.useEffect)(()=>u(i?i.current:N.F3.toDOMNode(a,n)),[a,n,i]);let g=(0,h.useCallback)(e=>{let t=eD.get(a);if(!t||!d)return;e.preventDefault(),e.dataTransfer.dropEffect="move",eP.set(a,n);let r=d.getBoundingClientRect(),i=r.top,l=r.height,s=e.pageY,c="bottom";if(n===a.children[0]?c="top":Math.abs(i-s)<l/2?(c="top",eL.set(a,c)):(c="bottom",eL.set(a,c)),t===n){e.dataTransfer.dropEffect="none";return}o(!0)},[d,a,n]),y=(0,h.useCallback)(()=>{o(!1)},[]),m=(0,h.useCallback)(e=>{let t=eP.get(a);if(t){eN.set(a,!1),e.preventDefault(),e.stopPropagation(),eP.delete(a),l.current&&(t$("Removing drag ghost"),document.body.removeChild(l.current));let r=eL.get(a);eL.delete(a);let i=N.F3.findPath(a,t),s=N.F3.findPath(a,n),o=_.y$.isBefore(s,i);if("bottom"===r&&!o){if(i[0]>=a.children.length-1){t$("target is already at the bottom, not moving");return}let c=i;i=_.y$.next(i),t$("Adjusting targetPath from ".concat(JSON.stringify(c)," to ").concat(JSON.stringify(i)))}if("top"===r&&o&&i[0]!==a.children.length-1){let h=i;i=_.y$.previous(i),t$("Adjusting targetPath from ".concat(JSON.stringify(h)," to ").concat(JSON.stringify(i)))}if(_.y$.equals(i,s)){e.preventDefault(),t$("targetPath and myPath is the same, not moving");return}t$("Moving element ".concat(n._key," from path ").concat(JSON.stringify(s)," to ").concat(JSON.stringify(i)," (").concat(r,")")),_.YR.moveNodes(a,{at:s,to:i}),a.onChange();return}t$("No target element, not doing anything")},[a,n]),k=(0,h.useCallback)(e=>{eD.get(a)&&(t$("On drop (prevented)",n),e.preventDefault(),e.stopPropagation(),o(!1))},[a,n]),v=(0,h.useCallback)(e=>{if(!f){eD.delete(a);return}eN.set(a,!0),eD.set(a,n),e.stopPropagation();let t=e.target;t instanceof HTMLElement&&(t.style.opacity="1")},[a,n,f]),b=(0,h.useCallback)(e=>{if(!f||p){t$("Not dragging block"),eD.delete(a),eN.set(a,!1);return}if(t$("Drag start"),eN.set(a,!0),e.dataTransfer&&(e.dataTransfer.setData("application/portable-text","something"),e.dataTransfer.effectAllowed="move"),d&&d instanceof HTMLElement){let t=d.cloneNode(!0),n=t.querySelector("[data-pt-drag-ghost-element]");if(n&&(t=n),t.setAttribute("data-dragged",""),document.body){l.current=t,t.style.position="absolute",t.style.left="-99999px",t.style.boxSizing="border-box",document.body.appendChild(t);let r=d.getBoundingClientRect(),i=e.clientX-r.left,s=e.clientY-r.top;t.style.width="".concat(r.width,"px"),t.style.height="".concat(r.height,"px"),e.dataTransfer.setDragImage(t,i,s)}}v(e)},[d,a,v,p,f]),x=s&&a.children[0]===eP.get(a),w=s&&a.children[a.children.length-1]===eP.get(a),M=eL.get(a),E=(0,h.useMemo)(()=>(0,c.jsx)("div",{className:"pt-drop-indicator",style:{position:"absolute",width:"100%",height:1,borderBottom:"1px solid currentColor",zIndex:5}}),[]);return r?(0,c.jsx)(c.Fragment,{children:t}):(0,c.jsxs)("div",{draggable:f,onDragStart:b,onDrag:v,onDragOver:g,onDragLeave:y,onDragEnd:m,onDrop:k,children:[(x||s&&!x&&!w&&"top"===M)&&E,t,(w||s&&!x&&!w&&"bottom"===M)&&E]})};eb("components:Element");let tq=[],tZ={display:"inline-block"},tG=e=>{let t,{attributes:n,children:r,element:i,schemaTypes:a,readOnly:l,renderBlock:s,renderChild:o,renderListItem:f,renderStyle:p,spellCheck:d}=e,u=(0,N._7)(),g=(0,N.vt)(),y=(0,h.useRef)(null),m=(0,h.useRef)(null),k=g&&u.selection&&_.e6.isCollapsed(u.selection)||!1,v=(0,h.useMemo)(()=>eE([i],a.block.name,eS.get(u))[0],[u,i,a.block.name]),b=r,x=(0,h.useMemo)(()=>[{_key:i._key}],[i]);if("string"!=typeof i._type)throw Error("Expected element to have a _type property");if("string"!=typeof i._key)throw Error("Expected element to have a _key property");if(u.isInline(i)){let w=N.F3.findPath(u,i),[M]=_.ML.node(u,w,{depth:1}),E=a.inlineObjects.find(e=>e.name===i._type);if(!E)throw Error("Could not find type for inline block element");if(_.W_.isElement(M)){let T=[{_key:M._key},"children",{_key:i._key}];return(0,c.jsxs)("span",ef(ef({},n),{},{children:[r,(0,c.jsx)(tY,{element:i,readOnly:l,children:(0,c.jsxs)("span",{className:"pt-inline-object",ref:m,style:tZ,contentEditable:!1,children:[o&&o({annotations:tq,children:(0,c.jsx)(tJ,{value:v}),value:v,schemaType:E,focused:k,selected:g,path:T,editorElementRef:m}),!o&&(0,c.jsx)(tJ,{value:v})]},i._key)})]}))}throw Error("Block not found!")}if(i._type===a.block.name){let D;t="pt-block pt-text-block";let A="listItem"in i,P="style"in i&&i.style||"normal";t="pt-block pt-text-block pt-text-block-style-".concat(P);let I=a.styles.find(e=>e.value===P);if(p&&I&&(b=p({block:i,children:r,focused:k,selected:g,value:P,path:x,type:I,editorElementRef:y})),A&&("number"==typeof i.level&&(D=i.level),t+=" pt-list-item pt-list-item-".concat(i.listItem," pt-list-item-level-").concat(D||1)),u.isListBlock(v)&&A&&i.listItem){let L=a.lists.find(e=>e.value===i.listItem);b=f&&L?f({block:v,children:b,focused:k,selected:g,value:i.listItem,path:x,type:L,level:v.level||1,editorElementRef:y}):(0,c.jsx)(tz,{listStyle:v.listItem||a.lists[0].value,listLevel:v.level||1,children:(0,c.jsx)(tF,{children:b})})}let C={children:b,editorElementRef:y,focused:k,level:D,listItem:A?i.listItem:void 0,path:x,selected:g,style:P,type:a.block,value:v},S=s?s(C):r;return(0,c.jsx)("div",ef(ef({},n),{},{className:t,spellCheck:d,children:(0,c.jsx)(tH,{element:i,readOnly:l,blockRef:y,children:(0,c.jsx)("div",{ref:y,children:S})})}),i._key)}let O=a.blockObjects.find(e=>e.name===i._type);if(!O)throw Error("Could not find schema type for block element of _type ".concat(i._type));t="pt-block pt-object-block";let R=eE([i],a.block.name,eS.get(u))[0],B=s&&s({children:(0,c.jsx)(tJ,{value:v}),value:R,type:O,selected:g,focused:k,path:x,editorElementRef:y});return(0,c.jsxs)("div",ef(ef({},n),{},{className:t,children:[r,(0,c.jsxs)(tH,{element:i,readOnly:l,blockRef:y,children:[B&&(0,c.jsx)("div",{ref:y,contentEditable:!1,children:B}),!B&&(0,c.jsx)(tV,{selected:g,children:(0,c.jsx)(tJ,{value:v})})]})]}),i._key)},tX="undefined"==typeof window?h.useEffect:h.useLayoutEffect,tK=eb("component:Editable"),tQ={opacity:.5,position:"absolute",userSelect:"none",pointerEvents:"none"},t0=()=>{},t1=[],t2=(0,h.forwardRef)(function(e,t){let{hotkeys:n,onBeforeInput:r,onPaste:i,onCopy:a,renderAnnotation:l,renderBlock:s,renderChild:o,renderDecorator:f,renderListItem:p,renderPlaceholder:d,renderStyle:u,selection:g,scrollSelectionIntoView:y,spellCheck:m}=e,k=ec(e,es),v=eB(),b=eJ(),x=function(e){let t=(0,h.useRef)(null);return tX(()=>{e&&("function"==typeof e?e(t.current):e.current=t.current)}),t}(t),{change$:w,keyGenerator:E,schemaTypes:T,slateInstance:D}=v,A=T.block.name,P=(0,h.useMemo)(()=>function(e){let t=T.block.name,n=T.span.name,r=t=>t.map(t=>{var r;return e.isTextBlock(t)?t.children.map(e=>{var t;return e._type===n?e.text:"[".concat((null==(t=T.inlineObjects.find(t=>t.name===e._type))?void 0:t.title)||"Object","]")}).join(""):"[".concat((null==(r=T.blockObjects.find(e=>e.name===t._type))?void 0:r.title)||"Object","]")}).join("\n\n");return e.setFragmentData=(n,i)=>{let{selection:a}=e;if(!a)return;let[l,s]=_.e6.edges(a),o=_.ML.void(e,{at:l.path}),c=_.ML.void(e,{at:s.path});if(_.e6.isCollapsed(a)&&!o)return;let h=N.F3.toDOMRange(e,a),f=h.cloneContents();if(c){let[p]=c,d=h.cloneRange(),u=N.F3.toDOMNode(e,p);d.setEndAfter(u),f=d.cloneContents()}Array.from(f.querySelectorAll("[data-slate-zero-width]")).forEach(e=>{let t="n"===e.getAttribute("data-slate-zero-width");e.textContent=t?"\n":""}),Array.from(f.querySelectorAll("*")).forEach(e=>{for(let t in e.removeAttribute("contentEditable"),e.removeAttribute("data-slate-inline"),e.removeAttribute("data-slate-leaf"),e.removeAttribute("data-slate-node"),e.removeAttribute("data-slate-spacer"),e.removeAttribute("data-slate-string"),e.removeAttribute("data-slate-zero-width"),e.removeAttribute("draggable"),e.attributes)e.hasAttribute(t)&&e.removeAttribute(t)});let g=f.ownerDocument.createElement("div");g.appendChild(f),g.setAttribute("hidden","true"),f.ownerDocument.body.appendChild(g);let y=g.innerHTML;f.ownerDocument.body.removeChild(g);let m=e.getFragment(),k=eE(m,t),v=JSON.stringify(k),b=r(k);n.clearData(),n.setData("text/plain",b),n.setData("text/html",y),n.setData("application/json",v),n.setData("application/x-portable-text",v),tT("text",b),n.setData("application/x-portable-text-event-origin",i||"external"),tT("Set fragment data",v,y)},e.insertPortableTextData=t=>{var r;if(!e.selection)return!1;let i=t.getData("application/x-portable-text"),a=t.getData("application/x-portable-text-event-origin");if(tT("Inserting portable text from ".concat(a," event"),i),i){let l=JSON.parse(i);if(Array.isArray(l)&&l.length>0){let s=eM(l,{schemaTypes:T}).map(t=>{let r=ef({},t);e.isTextBlock(r)&&(r.markDefs=(r.markDefs||[]).map(t=>{let i=t._key,a=E();return e.isTextBlock(r)&&(r.children=r.children.map(t=>t._type===n&&e.isTextSpan(t)?ef(ef({},t),{},{marks:t.marks&&t.marks.includes(i)?[...t.marks].filter(e=>e!==i).concat(a):t.marks}):t)),ef(ef({},t),{},{_key:a})}));let i=ef(ef({},r),{},{_key:E()});return e.isTextBlock(i)&&(i.children=i.children.map(e=>ef(ef({},e),{},{_key:E()}))),i}),o=ev(l,T,E);if(!o.valid){let c="".concat(null==(r=o.resolution)?void 0:r.description);return w.next({type:"error",level:"warning",name:"pasteError",description:c,data:o}),tT("Invalid insert result",o),!1}return tD(e,s),e.insertFragment(s),e.onChange(),!0}}return!1},e.insertTextOrHTMLData=n=>{var r;if(!e.selection)return tT("No selection, not inserting"),!1;w.next({type:"loading",isLoading:!0});let i=n.getData("text/html"),a=n.getData("text/plain");if(i||a){let l,s,o;if(tT("Inserting data",n),i)s=eM(l=(0,Q.zW)(i,T.portableText).map(e=>(0,Q.nX)(e,{blockTypeName:t})),{schemaTypes:T}),o="HTML";else{let c=String(a).replace(/[&<>"'`=/]/g,e=>tN[e]).split(/\n{2,}/).map(e=>e?"<p>".concat(e.replace(/(?:\r\n|\r|\n)/g,"<br/>"),"</p>"):"<p></p>").join("");s=eM(l=(0,Q.zW)("<html><body>".concat(c,"</body></html>"),T.portableText).map(e=>(0,Q.nX)(e,{blockTypeName:t})),{schemaTypes:T}),o="text"}let h=ev(l,T,E);if(!h.valid){let f="Could not validate the resulting portable text to insert.\n".concat(null==(r=h.resolution)?void 0:r.description,"\nTry to insert as plain text (shift-paste) instead.");return w.next({type:"error",level:"warning",name:"pasteError",description:f,data:h}),tT("Invalid insert result",h),!1}return tT("Inserting ".concat(o," fragment at ").concat(JSON.stringify(e.selection))),tD(e,s),e.insertFragment(s),e.onChange(),w.next({type:"loading",isLoading:!1}),!0}return w.next({type:"loading",isLoading:!1}),!1},e.insertData=t=>{e.insertPortableTextData(t)||e.insertTextOrHTMLData(t)},e.insertFragmentData=t=>{let n=t.getData("application/x-portable-text");if(n){let r=JSON.parse(n);return e.insertFragment(r),!0}return!1},e},[w,E,T]),I=(0,h.useMemo)(()=>(function(e,t,n,r){let i=["enter","tab","shift","delete","end"],a=r||tE,l=()=>eM([{_type:e.block.name,_key:t(),style:"normal",markDefs:[],children:[{_type:"span",_key:t(),text:"",marks:[]}]}],n)[0];return function(t){return t.pteWithHotKeys=r=>{Object.keys(a).forEach(e=>{if("marks"===e)for(let l in a[e]){if(i.includes(l))throw Error("The hotkey ".concat(l," is reserved!"));if((0,K.ZP)(l,r.nativeEvent)){r.preventDefault();let s=a[e];if(s){let o=s[l];tM("HotKey ".concat(l," to toggle ").concat(o)),t.pteToggleMark(o)}}}if("custom"===e)for(let c in a[e]){if(i.includes(c))throw Error("The hotkey ".concat(c," is reserved!"));if((0,K.ZP)(c,r.nativeEvent)){let h=a[e];if(h){let f=h[c];f(r,n)}}}});let s=(0,K.ZP)("enter",r.nativeEvent),o=(0,K.ZP)("tab",r.nativeEvent),c=(0,K.ZP)("shift+enter",r.nativeEvent),h=(0,K.ZP)("shift+tab",r.nativeEvent),f=(0,K.ZP)("backspace",r.nativeEvent),p=(0,K.ZP)("delete",r.nativeEvent);if(f&&t.selection&&t.selection.focus.path[0]>0&&_.e6.isCollapsed(t.selection)){let[d,u]=_.ML.node(t,_.y$.previous(t.selection.focus.path.slice(0,1))),[g]=_.ML.node(t,t.selection.focus,{depth:1});if(d&&g&&_.ML.isVoid(t,d)&&0===t.selection.focus.offset){tM("Preventing deleting void block above"),r.preventDefault(),r.stopPropagation(),_.YR.removeNodes(t,{match:e=>e===g}),_.YR.select(t,u),t.onChange();return}}if(p&&t.selection&&0===t.selection.focus.offset&&_.e6.isCollapsed(t.selection)&&t.children[t.selection.focus.path[0]+1]){let[y]=_.ML.node(t,_.y$.next(t.selection.focus.path.slice(0,1))),[m,k]=_.ML.node(t,t.selection.focus,{depth:1});if(y&&m&&!_.ML.isVoid(t,m)&&_.ML.isVoid(t,y)){tM("Preventing deleting void block below"),r.preventDefault(),r.stopPropagation(),_.YR.removeNodes(t,{match:e=>e===m}),_.YR.select(t,k),t.onChange();return}}if((o||h)&&t.selection){let[v]=_.ML.node(t,t.selection.focus,{depth:2}),[b]=(0,z.NG)(v)?_.ML.node(t,t.selection.focus,{depth:1}):[],x=v&&(0,z.DG)(b)&&(0,z.NG)(v)&&(v.marks||[]).filter(e=>(b.markDefs||[]).map(e=>e._key).includes(e)).length>0,[w]=_.e6.edges(t.selection),M=_.ML.isStart(t,w,w.path);v&&(0,z.NG)(v)&&(!x||M)&&t.pteIncrementBlockLevels(h)&&r.preventDefault()}if(s&&!c&&t.selection){let E;try{[E]=_.ML.node(t,t.selection.focus,{depth:1})}catch(T){}if(t.isListBlock(E)){t.pteEndList()&&r.preventDefault();return}if(t.isTextBlock(E)&&E.style&&E.style!==e.styles[0].value){let[,N]=_.e6.edges(t.selection),D=_.ML.isEnd(t,N,N.path);if(D){_.ML.insertNode(t,l()),r.preventDefault();return}}if(E&&_.ML.isVoid(t,E)){_.ML.insertNode(t,l()),r.preventDefault();return}}if(c){r.preventDefault(),t.insertText("\n");return}if((0,K.ZP)("mod+z",r.nativeEvent)){r.preventDefault(),t.undo();return}((0,K.ZP)("mod+y",r.nativeEvent)||(0,K.ZP)("mod+shift+z",r.nativeEvent))&&(r.preventDefault(),t.redo())},t}})(T,E,v,n),[n,E,v,T]);(0,h.useMemo)(()=>b?(tK("Editable is in read only mode"),P(D)):(tK("Editable is in edit mode"),P(I(D))),[b,D,I,P]);let L=(0,h.useCallback)(e=>(0,c.jsx)(tG,ef(ef({},e),{},{schemaTypes:T,readOnly:b,renderBlock:s,renderChild:o,renderListItem:p,renderStyle:u,spellCheck:m})),[T,m,b,s,o,p,u]),C=(0,h.useCallback)(e=>d&&e.leaf.placeholder&&""===e.text.text?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{style:tQ,contentEditable:!1,children:d()}),(0,c.jsx)(tW,ef(ef({},e),{},{keyGenerator:E,schemaTypes:T,renderAnnotation:l,renderChild:o,renderDecorator:f,readOnly:b}))]}):(0,c.jsx)(tW,ef(ef({},e),{},{keyGenerator:E,schemaTypes:T,renderAnnotation:l,renderChild:o,renderDecorator:f,readOnly:b})),[E,b,l,o,f,d,T]);(0,h.useEffect)(()=>{if(g){tK("Selection from props ".concat(JSON.stringify(g)));let e=function(e,t){if(!e||!t||0===t.length)return null;let n=null,r=null,{anchor:i,focus:a}=e;return(i&&t.find(e=>M()({_key:e._key},i.path[0]))&&(n=tR(i,t)),a&&t.find(e=>M()({_key:e._key},a.path[0]))&&(r=tR(a,t)),n&&r)?{anchor:n,focus:r}:null}(g,eE(D.children,A));if(null!==e){tK("Normalized selection from props ".concat(JSON.stringify(e)));let t=eH(e,D);t&&(_.YR.select(D,t),D.operations.some(e=>"set_selection"===e.type)||w.next({type:"selection",selection:e}),D.onChange())}}},[D,g,A,w]),(0,h.useEffect)(()=>{g&&tC.select(v,g)},[]);let S=(0,h.useCallback)(e=>{if(a){let t=a(e);void 0!==t&&e.preventDefault()}},[a]),O=(0,h.useCallback)(e=>{if(e.preventDefault(),D.selection){if(!i){tK("Pasting normally"),D.insertData(e.clipboardData);return}new Promise(t=>{var n;t(i({event:e,value:tC.getValue(v),path:(null==(n=D.selection)?void 0:n.focus.path)||[],schemaTypes:T}))}).then(t=>{if(tK("Custom paste function from client resolved",t),w.next({type:"loading",isLoading:!0}),!t||!t.insert){tK("No result from custom paste handler, pasting normally"),D.insertData(e.clipboardData);return}if(t&&t.insert){D.insertFragment(eM(t.insert,{schemaTypes:T})),w.next({type:"loading",isLoading:!1});return}console.warn("Your onPaste function returned something unexpected:",t)}).catch(e=>(w.next({type:"loading",isLoading:!1}),console.error(e),e))}},[w,i,v,T,D]),R=(0,h.useCallback)(()=>{w.next({type:"focus"})},[w]),B=(0,h.useCallback)(()=>{w.next({type:"blur"})},[w]),j=(0,h.useCallback)(e=>{r&&r(e)},[r]),Y=D.pteWithHotKeys,W=(0,h.useMemo)(()=>void 0===y?void 0:null===y?t0:(e,t)=>{y(v,t)},[v,y]),J=(0,h.useCallback)(()=>eT(D.children,T)?[{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0},placeholder:!0}]:t1,[D.children]),V=(0,h.useMemo)(()=>(0,c.jsx)(N.CX,{autoFocus:!1,className:"pt-editable",decorate:J,onBlur:B,onCopy:S,onDOMBeforeInput:j,onFocus:R,onKeyDown:Y,onPaste:O,readOnly:b,renderElement:L,renderLeaf:C,scrollSelectionIntoView:W}),[J,S,Y,j,B,R,O,b,L,C,W]);return v?(0,c.jsx)("div",ef(ef({ref:x},k),{},{children:V})):null})}}]);